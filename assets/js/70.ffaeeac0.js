(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{834:function(t,i,e){"use strict";e.r(i),function(t,o){e.d(i,"Field",(function(){return h})),e.d(i,"ScalarFill",(function(){return $})),e.d(i,"WindLayer",(function(){return it}));var n=e(134),s=(e(207),e(208),e(132),e(6),e(198),e(98),e(99),e(199),e(200),e(201),e(95),e(96),e(202),e(203),e(204),e(13),e(213),e(209),e(222),e(223),e(224),e(225),e(226),e(227),e(228),e(229),e(230),e(231),e(232),e(233),e(234),e(235),e(236),e(237),e(238),e(239),e(240),e(241),e(242),e(243),e(244),e(245),e(246),e(247),e(248),e(11),e(15),e(249),e(197),e(133),e(97),e(214),e(101),e(217),e(250),e(251),e(819)),r=function(t,i){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.1.0-alpha.0
 * build-time: 2021-3-21 18:42
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function g(){for(var t=arguments,i=0,e=0,o=arguments.length;e<o;e++)i+=t[e].length;var n=Array(i),s=0;for(e=0;e<o;e++)for(var r=arguments[e],g=0,a=r.length;g<a;g++,s++)n[s]=r[g];return n}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){var e=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),n=1;n<arguments.length;n++){var s=e[n];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(o[r]=s[r])}return o},writable:!0,configurable:!0});var a=Object.prototype.hasOwnProperty,I="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function c(t){if(!function(t){var i=Object(n.a)(t);return null!==t&&("object"===i||"function"===i)}(t))return!1;var i=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(I&&I in Object(t)))return toString.call(t);var i=a.call(t,I),e=t[I],o=!1;try{t[I]=void 0,o=!0}catch(t){}var n=Object.prototype.toString.call(t);return o&&(i?t[I]=e:delete t[I]),n}(t);return"[object Function]"===i||"[object AsyncFunction]"===i||"[object GeneratorFunction]"===i||"[object Proxy]"===i}function l(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function B(t){for(var i=arguments,e=[],o=1;o<arguments.length;o++)e[o-1]=i[o];return Object.assign.apply(Object,g([t],e))}function u(t){return null!=t&&!isNaN(t)}var d=function(){function t(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),h=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaY<0&&this.ymin<this.ymax?console.warn("[wind-core]: The data is flipY"):(this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin)),this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),e=Math.ceil((this.ymax-this.ymin)/t.deltaY);i===this.cols&&e===this.rows||console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],i=0,e=this.rows,o=this.cols,n=this.us,s=this.vs,r=0;r<e;r++){for(var g=[],a=0;a<o;a++,i++){var I=n[i],c=s[i],l=this.isValid(I)&&this.isValid(c);g[a]=l?new d(I,c):null}this.isContinuous&&g.push(g[0]),t[r]=g}return t},t.prototype.release=function(){this.grid=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,i,e,o,n,s){var r=1-t,g=1-i,a=r*g,I=t*g,c=r*i,l=t*i,B=e.u*a+o.u*I+n.u*c+s.u*l,u=e.v*a+o.v*I+n.v*c+s.v*l;return new d(B,u)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,i,e=this.grid.length,o=this.grid[0].length,n=0;n<e;n++)for(var s=0;s<o;s++){var r=this.grid[n][s];if(null!==r){var g=r.m||r.magnitude();void 0===t?t=g:void 0===i?(i=g,t=Math.min(t,i),i=Math.max(t,i)):(t=Math.min(g,t),i=Math.max(g,i))}}return[t,i]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},t.prototype.contains=function(t,i){var e,o=this.getWrappedLongitudes(),n=o[0],s=o[1],r=t>=n&&t<=s;return e=this.deltaY>=0?i>=this.ymin&&i<=this.ymax:i>=this.ymax&&i<=this.ymin,r&&e},t.prototype.getDecimalIndexes=function(t,i){var e,o;return[((e=t-this.xmin)-(o=360)*Math.floor(e/o))/this.deltaX,(this.ymax-i)/this.deltaY]},t.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),o=Math.floor(e[0]),n=Math.floor(e[1]),s=this.clampColumnIndex(o),r=this.clampRowIndex(n);return this.valueAtIndexes(s,r)},t.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),o=e[0],n=e[1];return this.interpolatePoint(o,n)},t.prototype.hasValueAt=function(t,i){return null!==this.valueAt(t,i)},t.prototype.interpolatePoint=function(t,i){var e=this.getFourSurroundingIndexes(t,i),o=e[0],n=e[1],s=e[2],r=e[3],g=this.getFourSurroundingValues(o,n,s,r);if(g){var a=g[0],I=g[1],c=g[2],l=g[3];return this.bilinearInterpolateVector(t-o,i-s,a,I,c,l)}return null},t.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var e=this.cols-1;return t>e&&(i=e),i},t.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var e=this.rows-1;return t>e&&(i=e),i},t.prototype.getFourSurroundingIndexes=function(t,i){var e=Math.floor(t),o=e+1;this.isContinuous&&o>=this.cols&&(o=0),o=this.clampColumnIndex(o);var n=this.clampRowIndex(Math.floor(i));return[e,o,n,this.clampRowIndex(n+1)]},t.prototype.getFourSurroundingValues=function(t,i,e,o){var n;if(n=this.grid[e]){var s=n[t],r=n[i];if(this.isValid(s)&&this.isValid(r)&&(n=this.grid[o])){var g=n[t],a=n[i];if(this.isValid(g)&&this.isValid(a))return[s,r,g,a]}}return null},t.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},t.prototype.lonLatAtIndexes=function(t,i){return[this.longitudeAtX(t),this.latitudeAtY(i)]},t.prototype.longitudeAtX=function(t){var i=this.deltaX/2,e=this.xmin+i+t*this.deltaX;return this.wrappedX&&(e=e>180?e-360:e),e},t.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},t.prototype.randomize=function(t,i,e,o){void 0===t&&(t={});var n=Math.random()*(i||this.cols)|0,s=Math.random()*(e||this.rows)|0,r=o([n,s]);return null!==r?(t.x=r[0],t.y=r[1]):(t.x=this.longitudeAtX(n),t.y=this.latitudeAtY(s)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,i,e){},t}(),F={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0};function Q(t,i,e,o){return Math.max(0,Math.min(o.length-1,Math.round((t-i)/(e-i)*(o.length-1))))}var C=function(){function t(t,i,e){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),e&&this.updateData(e)}return t.prototype.setOptions=function(t){this.options=Object.assign({},F,t);var i=this.ctx.canvas,e=i.width,o=i.height;"particleAge"in t&&!("maxAge"in t)&&l(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&l(this.options.particleMultiplier)&&(this.options.paths=Math.round(e*o*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,e=t.height,o=this.particles,n=this.options.maxAge,s=c(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,r=0,g=o.length;r<g;r++){var a=o[r];a.age>n&&(a.age=0,this.field.randomize(a,i,e,this.unproject));var I=a.x,l=a.y,B=this.field.interpolatedValueAt(I,l);if(null===B)a.age=n;else{var u=I+B.u*s,d=l+B.v*s;this.field.hasValueAt(u,d)?(a.xt=u,a.yt=d,a.m=B.m):(a.x=u,a.y=d,a.age=n)}a.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t,i,e=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=l(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(i=this.options.colorScale)&&("string"==typeof i||null!==i.constructor&&i.constructor===String)?this.options.colorScale:"#fff";var o=0,n=e.length;if(this.field&&n>0){var s=void 0,r=void 0;for(u(this.options.minVelocity)&&u(this.options.maxVelocity)?(s=this.options.minVelocity,r=this.options.maxVelocity):(s=(t=this.field.range)[0],r=t[1]);o<n;o++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](e[o],s,r)}},t.prototype.drawPixelParticle=function(t,i,e){var o=[t.x,t.y],n=[t.xt,t.yt];if(n&&o&&u(n[0])&&u(n[1])&&u(o[0])&&u(o[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(o[0],o[1]),this.ctx.lineTo(n[0],n[1]),c(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var s=Q(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[s]}c(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,i,e){var o=[t.x,t.y],n=[t.xt,t.yt];if(n&&o&&u(n[0])&&u(n[1])&&u(o[0])&&u(o[1])&&this.intersectsCoordinate(n)&&t.age<=this.options.maxAge){var s=this.project(o),r=this.project(n);if(s&&r){if(this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(r[0],r[1]),t.x=t.xt,t.y=t.yt,c(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var g=Q(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[g]}c(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,e=t.height,o="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,n=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,e,this.unproject);for(var s=0;s<o;s++)n.push(this.field.randomize({age:this.randomize()},i,e,this.unproject));return n},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate()))},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=h,t}();function y(t){return t?(t.parentNode&&t.parentNode.removeChild(t),t):null}var U=function(){function t(t,i){if(void 0===i&&(i={}),!t)throw Error("layer id must be specified");this.id=t,this.options=i,this.canvas=null,this.canvas2=null,this.devicePixelRatio=this.options.devicePixelRatio||window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI,this.render=this.render.bind(this),this.type="custom",this.renderingMode="2d"}return t.prototype.onAdd=function(t){this.setMap(t),this.canvas=this.initialize(),this.options.doubleBuffer&&(this.canvas2=this.initialize())},t.prototype.resizeCanvas=function(t){var i=this.map.getCanvas(),e=this.map.transform,o=e.width,n=e.height,s=this.devicePixelRatio;t.width=o*s,t.height=n*s,t.style.width=i.style.width,t.style.height=i.style.height},t.prototype.initialize=function(){var t=this.map.getCanvasContainer(),i=this.map.getCanvas(),e=document.createElement("canvas"),o=this.map.transform,n=o.width,s=o.height,r=this.devicePixelRatio;return e.width=n*r,e.height=s*r,e.style.position="absolute",e.className="mapbox-overlay-canvas",e.style.width=i.style.width,e.style.height=i.style.height,t.appendChild(e),e},t.prototype.render=function(){},t.prototype.project=function(t){if(void 0!==this.map){var i=this.map.project(new s.LngLat(t[0],t[1])),e=i.x,o=i.y;return[e*this.devicePixelRatio,o*this.devicePixelRatio]}return t},t.prototype.unproject=function(t){if(void 0!==this.map){var i=this.map.unproject(new s.Point(t[0],t[1]));return[i.lng,i.lat]}return t},t.prototype.intersectsCoordinate=function(t){var i,e,o=this.map.getBounds(),n=null===(e=null===(i=this.map)||void 0===i?void 0:i.transform)||void 0===e?void 0:e.latRange;return(!n||!(t[1]>n[1]||t[1]<n[0]))&&o.contains(new s.LngLat(t[0],t[1]))},t.prototype.clear=function(){var t;this.canvas&&((t=this.canvas.getContext("2d"))&&t.clearRect(0,0,this.canvas.width,this.canvas.height));this.canvas2&&((t=this.canvas2.getContext("2d"))&&t.clearRect(0,0,this.canvas2.width,this.canvas2.height))},t.prototype.setMap=function(t){return this.map=t,this},t.prototype.getMap=function(){return this.map},t.prototype.addTo=function(t){this.onAdd(t)},t.prototype.remove=function(){this.canvas&&(y(this.canvas),this.canvas=null),this.canvas2&&(y(this.canvas2),this.canvas2=null)},t}(),p=function(t,i){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(t,i)};
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-gl-core v1.1.0-alpha.0
 * build-time: 2021-3-21 18:42
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function A(t,i){function e(){this.constructor=t}p(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}var m=function(){return(m=Object.assign||function(t){for(var i,e=arguments,o=1,n=arguments.length;o<n;o++)for(var s in i=e[o])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},x=null;try{var b="function"==typeof t.require&&e(!function(){var t=new Error("Cannot find module 'worker_threads'");throw t.code="MODULE_NOT_FOUND",t}())||"function"==typeof require&&require("worker_threads")||e(!function(){var t=new Error("Cannot find module 'worker_threads'");throw t.code="MODULE_NOT_FOUND",t}());x=b.Worker}catch(t){}function G(t,i,e){var n=void 0===i?null:i,s=function(t,i){return o.from(t,"base64").toString(i?"utf16":"utf8")}(t,void 0!==e&&e),r=s.indexOf("\n",10)+1,g=s.substring(r)+(n?"//# sourceMappingURL="+n:"");return function(t){return new x(g,Object.assign({},t,{eval:!0}))}}function f(t,i,e){var o=void 0===i?null:i,n=function(t,i){var e=atob(t);if(i){for(var o=new Uint8Array(e.length),n=0,s=e.length;n<s;++n)o[n]=e.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(o.buffer))}return e}(t,void 0!==e&&e),s=n.indexOf("\n",10)+1,r=n.substring(s)+(o?"//# sourceMappingURL="+o:""),g=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(g)}var v="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);var S,X,R,L=(S="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLg0KTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZQ0KdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUNCkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQoNClRISVMgQ09ERSBJUyBQUk9WSURFRCBPTiBBTiAqQVMgSVMqIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkNCktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRUQNCldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsDQpNRVJDSEFOVEFCTElUWSBPUiBOT04tSU5GUklOR0VNRU5ULg0KDQpTZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMNCmFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovDQoNCmZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHsNCiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsNCiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9DQogICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsNCiAgICB9KTsNCn0NCg0KZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkgew0KICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgeyB0aHJvdyB0WzFdOyB9IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLiIpOyB9DQogICAgICAgIHdoaWxlIChfKSB7IHRyeSB7DQogICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgeyByZXR1cm4gdDsgfQ0KICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSB7IG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07IH0NCiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDQ6IF8ubGFiZWwrKzsgcmV0dXJuIHsgdmFsdWU6IG9wWzFdLCBkb25lOiBmYWxzZSB9Ow0KICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gNiAmJiBfLmxhYmVsIDwgdFsxXSkgeyBfLmxhYmVsID0gdFsxXTsgdCA9IG9wOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9DQogICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSB7IF8ub3BzLnBvcCgpOyB9DQogICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfSB9DQogICAgICAgIGlmIChvcFswXSAmIDUpIHsgdGhyb3cgb3BbMV07IH0gcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsNCiAgICB9DQp9CgpmdW5jdGlvbiBjYWxjTWluTWF4KGFycmF5KSB7CiAgICB2YXIgbWluID0gSW5maW5pdHk7CiAgICB2YXIgbWF4ID0gSW5maW5pdHk7CiAgICAvLyBAZnJvbTogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTM1NDQ0NzYvaG93LXRvLWZpbmQtbWF4LWFuZC1taW4taW4tYXJyYXktdXNpbmctbWluaW11bS1jb21wYXJpc29ucwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB2YWwgPSBhcnJheVtpXTsKICAgICAgICBpZiAobWluID09PSBJbmZpbml0eSkgewogICAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKG1heCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgICAgICAvLyB1cGRhdGUgbWluIG1heAogICAgICAgICAgICAvLyAxLiBQaWNrIDIgZWxlbWVudHMoYSwgYiksIGNvbXBhcmUgdGhlbS4gKHNheSBhID4gYikKICAgICAgICAgICAgbWluID0gTWF0aC5taW4obWluLCBtYXgpOwogICAgICAgICAgICBtYXggPSBNYXRoLm1heChtaW4sIG1heCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyAyLiBVcGRhdGUgbWluIGJ5IGNvbXBhcmluZyAobWluLCBiKQogICAgICAgICAgICAvLyAzLiBVcGRhdGUgbWF4IGJ5IGNvbXBhcmluZyAobWF4LCBhKQogICAgICAgICAgICBtaW4gPSBNYXRoLm1pbih2YWwsIG1pbik7CiAgICAgICAgICAgIG1heCA9IE1hdGgubWF4KHZhbCwgbWF4KTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gW21pbiwgbWF4XTsKfQoKdmFyIGN0eCA9IHNlbGY7CmN0eC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKF9hKSB7CiAgICB2YXIgcGF5bG9hZCA9IF9hLmRhdGE7CiAgICByZXR1cm4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmVuZGVyRm9ybSwgdURhdGEsIHZEYXRhLCBfYiwgdU1pbiwgdU1heCwgX2MsIHZNaW4sIHZNYXgsIHZlbG9jaXR5RGF0YSwgaSwgciwgZywgc2luZ2xlRGF0YSwgX2QsIG1pbiwgbWF4LCB2ZWxvY2l0eURhdGEsIGksIHI7CiAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfZSkgewogICAgICAgICAgICByZW5kZXJGb3JtID0gcGF5bG9hZFswXTsKICAgICAgICAgICAgaWYgKHJlbmRlckZvcm0gPT09ICdyZycpIHsKICAgICAgICAgICAgICAgIHVEYXRhID0gcGF5bG9hZFsxXTsKICAgICAgICAgICAgICAgIHZEYXRhID0gcGF5bG9hZFsyXTsKICAgICAgICAgICAgICAgIF9iID0gY2FsY01pbk1heCh1RGF0YSksIHVNaW4gPSBfYlswXSwgdU1heCA9IF9iWzFdOwogICAgICAgICAgICAgICAgX2MgPSBjYWxjTWluTWF4KHZEYXRhKSwgdk1pbiA9IF9jWzBdLCB2TWF4ID0gX2NbMV07CiAgICAgICAgICAgICAgICB2ZWxvY2l0eURhdGEgPSBuZXcgVWludDhBcnJheSh1RGF0YS5sZW5ndGggKiA0KTsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB1RGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHIgPSAyNTUgKiAodURhdGFbaV0gLSB1TWluKSAvICh1TWF4IC0gdU1pbik7CiAgICAgICAgICAgICAgICAgICAgZyA9IDI1NSAqICh2RGF0YVtpXSAtIHZNaW4pIC8gKHZNYXggLSB2TWluKTsKICAgICAgICAgICAgICAgICAgICB2ZWxvY2l0eURhdGEuc2V0KFtyLCBnLCAwLCAyNTVdLCBpICogNCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdHgucG9zdE1lc3NhZ2UoW3ZlbG9jaXR5RGF0YS5idWZmZXIsIHVNaW4sIHVNYXgsIHZNaW4sIHZNYXhdLCBbdmVsb2NpdHlEYXRhLmJ1ZmZlcl0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc2luZ2xlRGF0YSA9IHBheWxvYWRbMV07CiAgICAgICAgICAgICAgICBfZCA9IGNhbGNNaW5NYXgoc2luZ2xlRGF0YSksIG1pbiA9IF9kWzBdLCBtYXggPSBfZFsxXTsKICAgICAgICAgICAgICAgIHZlbG9jaXR5RGF0YSA9IG5ldyBVaW50OEFycmF5KHNpbmdsZURhdGEubGVuZ3RoICogNCk7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2luZ2xlRGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHIgPSAyNTUgKiAoc2luZ2xlRGF0YVtpXSAtIG1pbikgLyAobWF4IC0gbWluKTsKICAgICAgICAgICAgICAgICAgICB2ZWxvY2l0eURhdGEuc2V0KFtyLCAwLCAwLCAyNTVdLCBpICogNCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdHgucG9zdE1lc3NhZ2UoW3ZlbG9jaXR5RGF0YS5idWZmZXIsIG1pbiwgbWF4XSwgW3ZlbG9jaXR5RGF0YS5idWZmZXJdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gWzIgLypyZXR1cm4qL107CiAgICAgICAgfSk7CiAgICB9KTsKfSk7Cgo=",X="data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0YVByb2Nlc3NlLmpzIiwic291cmNlcyI6WyIuLi8uLi9ub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL3V0aWxzL2NvbW1vbi50cyIsInNyYy93b3JrZXJzL0RhdGFQcm9jZXNzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxyXG50aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxyXG5MaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxyXG5LSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVEXHJcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXHJcbk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuXHJcblxyXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcclxuYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVzdChzLCBlKSB7XHJcbiAgICB2YXIgdCA9IHt9O1xyXG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXHJcbiAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXHJcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgICAgICB9XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBleHBvcnRzKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdO1xyXG4gICAgaWYgKCFtKSByZXR1cm4gbztcclxuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikgeyBlID0geyBlcnJvcjogZXJyb3IgfTsgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgIXIuZG9uZSAmJiAobSA9IGlbXCJyZXR1cm5cIl0pKSBtLmNhbGwoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCJleHBvcnQgZnVuY3Rpb24gY2FsY01pbk1heChhcnJheTogbnVtYmVyW10pOiBbbnVtYmVyLCBudW1iZXJdIHtcbiAgbGV0IG1pbiA9IEluZmluaXR5O1xuICBsZXQgbWF4ID0gSW5maW5pdHk7XG4gIC8vIEBmcm9tOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMzU0NDQ3Ni9ob3ctdG8tZmluZC1tYXgtYW5kLW1pbi1pbi1hcnJheS11c2luZy1taW5pbXVtLWNvbXBhcmlzb25zXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCB2YWwgPSBhcnJheVtpXTtcblxuICAgIGlmIChtaW4gPT09IEluZmluaXR5KSB7XG4gICAgICBtaW4gPSB2YWw7XG4gICAgfSBlbHNlIGlmIChtYXggPT09IEluZmluaXR5KSB7XG4gICAgICBtYXggPSB2YWw7XG4gICAgICAvLyB1cGRhdGUgbWluIG1heFxuICAgICAgLy8gMS4gUGljayAyIGVsZW1lbnRzKGEsIGIpLCBjb21wYXJlIHRoZW0uIChzYXkgYSA+IGIpXG4gICAgICBtaW4gPSBNYXRoLm1pbihtaW4sIG1heCk7XG4gICAgICBtYXggPSBNYXRoLm1heChtaW4sIG1heCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIDIuIFVwZGF0ZSBtaW4gYnkgY29tcGFyaW5nIChtaW4sIGIpXG4gICAgICAvLyAzLiBVcGRhdGUgbWF4IGJ5IGNvbXBhcmluZyAobWF4LCBhKVxuICAgICAgbWluID0gTWF0aC5taW4odmFsLCBtaW4pO1xuICAgICAgbWF4ID0gTWF0aC5tYXgodmFsLCBtYXgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gW21pbiwgbWF4XTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTnVtYmVyKHZhbDogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgdmFsID09PSAnbnVtYmVyJyAmJiAhaXNOYU4odmFsKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRlKHZhbDogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWwgIT09IHVuZGVmaW5lZCAmJiB2YWwgIT09IG51bGwgJiYgIWlzTmFOKHZhbCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kU3RvcExlc3NUaGFuT3JFcXVhbFRvKHN0b3BzOiBudW1iZXJbXSwgaW5wdXQ6IG51bWJlcikge1xuICBjb25zdCBsYXN0SW5kZXggPSBzdG9wcy5sZW5ndGggLSAxO1xuICBsZXQgbG93ZXJJbmRleCA9IDA7XG4gIGxldCB1cHBlckluZGV4ID0gbGFzdEluZGV4O1xuICBsZXQgY3VycmVudEluZGV4ID0gMDtcbiAgbGV0IGN1cnJlbnRWYWx1ZTtcbiAgbGV0IG5leHRWYWx1ZTtcblxuICB3aGlsZSAobG93ZXJJbmRleCA8PSB1cHBlckluZGV4KSB7XG4gICAgY3VycmVudEluZGV4ID0gTWF0aC5mbG9vcigobG93ZXJJbmRleCArIHVwcGVySW5kZXgpIC8gMik7XG4gICAgY3VycmVudFZhbHVlID0gc3RvcHNbY3VycmVudEluZGV4XTtcbiAgICBuZXh0VmFsdWUgPSBzdG9wc1tjdXJyZW50SW5kZXggKyAxXTtcblxuICAgIGlmIChjdXJyZW50VmFsdWUgPD0gaW5wdXQpIHtcbiAgICAgIGlmIChjdXJyZW50SW5kZXggPT09IGxhc3RJbmRleCB8fCBpbnB1dCA8IG5leHRWYWx1ZSkge1xuICAgICAgICAvLyBTZWFyY2ggY29tcGxldGVcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRJbmRleDtcbiAgICAgIH1cblxuICAgICAgbG93ZXJJbmRleCA9IGN1cnJlbnRJbmRleCArIDE7XG4gICAgfSBlbHNlIGlmIChjdXJyZW50VmFsdWUgPiBpbnB1dCkge1xuICAgICAgdXBwZXJJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW5wdXQgaXMgbm90IGEgbnVtYmVyLicpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnA2NExvd1BhcnQoeDogbnVtYmVyKSB7XG4gIHJldHVybiB4IC0gTWF0aC5mcm91bmQoeCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXQ0SW52ZXJ0KG91dDogbnVtYmVyW10sIGE6IG51bWJlcltdKSB7XG4gIGNvbnN0IGEwMCA9IGFbMF07XG4gIGNvbnN0IGEwMSA9IGFbMV07XG4gIGNvbnN0IGEwMiA9IGFbMl07XG4gIGNvbnN0IGEwMyA9IGFbM107XG4gIGNvbnN0IGExMCA9IGFbNF07XG4gIGNvbnN0IGExMSA9IGFbNV07XG4gIGNvbnN0IGExMiA9IGFbNl07XG4gIGNvbnN0IGExMyA9IGFbN107XG4gIGNvbnN0IGEyMCA9IGFbOF07XG4gIGNvbnN0IGEyMSA9IGFbOV07XG4gIGNvbnN0IGEyMiA9IGFbMTBdO1xuICBjb25zdCBhMjMgPSBhWzExXTtcbiAgY29uc3QgYTMwID0gYVsxMl07XG4gIGNvbnN0IGEzMSA9IGFbMTNdO1xuICBjb25zdCBhMzIgPSBhWzE0XTtcbiAgY29uc3QgYTMzID0gYVsxNV07XG5cbiAgY29uc3QgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwO1xuICBjb25zdCBiMDEgPSBhMDAgKiBhMTIgLSBhMDIgKiBhMTA7XG4gIGNvbnN0IGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMDtcbiAgY29uc3QgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExO1xuICBjb25zdCBiMDQgPSBhMDEgKiBhMTMgLSBhMDMgKiBhMTE7XG4gIGNvbnN0IGIwNSA9IGEwMiAqIGExMyAtIGEwMyAqIGExMjtcbiAgY29uc3QgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwO1xuICBjb25zdCBiMDcgPSBhMjAgKiBhMzIgLSBhMjIgKiBhMzA7XG4gIGNvbnN0IGIwOCA9IGEyMCAqIGEzMyAtIGEyMyAqIGEzMDtcbiAgY29uc3QgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxO1xuICBjb25zdCBiMTAgPSBhMjEgKiBhMzMgLSBhMjMgKiBhMzE7XG4gIGNvbnN0IGIxMSA9IGEyMiAqIGEzMyAtIGEyMyAqIGEzMjtcblxuICAvLyBDYWxjdWxhdGUgdGhlIGRldGVybWluYW50XG4gIGxldCBkZXQgPVxuICAgIGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjtcblxuICBpZiAoIWRldCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGRldCA9IDEuMCAvIGRldDtcblxuICBvdXRbMF0gPSAoYTExICogYjExIC0gYTEyICogYjEwICsgYTEzICogYjA5KSAqIGRldDtcbiAgb3V0WzFdID0gKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQ7XG4gIG91dFsyXSA9IChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0O1xuICBvdXRbM10gPSAoYTIyICogYjA0IC0gYTIxICogYjA1IC0gYTIzICogYjAzKSAqIGRldDtcbiAgb3V0WzRdID0gKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQ7XG4gIG91dFs1XSA9IChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0O1xuICBvdXRbNl0gPSAoYTMyICogYjAyIC0gYTMwICogYjA1IC0gYTMzICogYjAxKSAqIGRldDtcbiAgb3V0WzddID0gKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQ7XG4gIG91dFs4XSA9IChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0O1xuICBvdXRbOV0gPSAoYTAxICogYjA4IC0gYTAwICogYjEwIC0gYTAzICogYjA2KSAqIGRldDtcbiAgb3V0WzEwXSA9IChhMzAgKiBiMDQgLSBhMzEgKiBiMDIgKyBhMzMgKiBiMDApICogZGV0O1xuICBvdXRbMTFdID0gKGEyMSAqIGIwMiAtIGEyMCAqIGIwNCAtIGEyMyAqIGIwMCkgKiBkZXQ7XG4gIG91dFsxMl0gPSAoYTExICogYjA3IC0gYTEwICogYjA5IC0gYTEyICogYjA2KSAqIGRldDtcbiAgb3V0WzEzXSA9IChhMDAgKiBiMDkgLSBhMDEgKiBiMDcgKyBhMDIgKiBiMDYpICogZGV0O1xuICBvdXRbMTRdID0gKGEzMSAqIGIwMSAtIGEzMCAqIGIwMyAtIGEzMiAqIGIwMCkgKiBkZXQ7XG4gIG91dFsxNV0gPSAoYTIwICogYjAzIC0gYTIxICogYjAxICsgYTIyICogYjAwKSAqIGRldDtcblxuICByZXR1cm4gb3V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNmb3JtTWF0NChvdXQ6IG51bWJlcltdLCBhOiBudW1iZXJbXSwgbTogbnVtYmVyW10pIHtcbiAgY29uc3QgeCA9IGFbMF07XG4gIGNvbnN0IHkgPSBhWzFdO1xuICBjb25zdCB6ID0gYVsyXTtcbiAgY29uc3QgdyA9IGFbM107XG4gIG91dFswXSA9IG1bMF0gKiB4ICsgbVs0XSAqIHkgKyBtWzhdICogeiArIG1bMTJdICogdzsgLy8gMFxuICBvdXRbMV0gPSBtWzFdICogeCArIG1bNV0gKiB5ICsgbVs5XSAqIHogKyBtWzEzXSAqIHc7IC8vIDBcbiAgb3V0WzJdID0gbVsyXSAqIHggKyBtWzZdICogeSArIG1bMTBdICogeiArIG1bMTRdICogdzsgLy8gMFxuICBvdXRbM10gPSBtWzNdICogeCArIG1bN10gKiB5ICsgbVsxMV0gKiB6ICsgbVsxNV0gKiB3OyAvLyAxXG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFeWUobWF0cml4OiBudW1iZXJbXSkge1xuICBjb25zdCBkZWZhdWx0TWF0NCA9IFsxLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAwLCAxXTsgLy8gaW5zdGVkIG9mIG1hdDQuY3JlYXRlKClcbiAgbGV0IGV5ZSA9IHRyYW5zZm9ybU1hdDQoXG4gICAgW10sXG4gICAgWzAsIDAsIDAsIDFdLFxuICAgIG1hdDRJbnZlcnQoZGVmYXVsdE1hdDQsIG1hdHJpeCkgYXMgbnVtYmVyW10sXG4gICk7XG4gIGNvbnN0IGNsaXBXID0gMS4wIC8gZXllWzNdO1xuICBleWUgPSBleWUubWFwKChpdGVtOiBudW1iZXIpID0+IGl0ZW0gLyBleWVbM10pO1xuICBleWVbM10gPSBjbGlwVztcbiAgcmV0dXJuIGV5ZTtcbn1cbiIsImltcG9ydCB7IGNhbGNNaW5NYXggfSBmcm9tICcuLi91dGlscy9jb21tb24nO1xuXG5jb25zdCBjdHg6IFdvcmtlciA9IHNlbGYgYXMgYW55O1xuXG5jdHguYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGFzeW5jICh7IGRhdGE6IHBheWxvYWQgfSkgPT4ge1xuICBjb25zdCByZW5kZXJGb3JtID0gcGF5bG9hZFswXTtcbiAgaWYgKHJlbmRlckZvcm0gPT09ICdyZycpIHtcbiAgICBjb25zdCB1RGF0YSA9IHBheWxvYWRbMV07XG4gICAgY29uc3QgdkRhdGEgPSBwYXlsb2FkWzJdO1xuICAgIGNvbnN0IFt1TWluLCB1TWF4XSA9IGNhbGNNaW5NYXgodURhdGEpO1xuICAgIGNvbnN0IFt2TWluLCB2TWF4XSA9IGNhbGNNaW5NYXgodkRhdGEpO1xuICAgIGNvbnN0IHZlbG9jaXR5RGF0YSA9IG5ldyBVaW50OEFycmF5KHVEYXRhLmxlbmd0aCAqIDQpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdURhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHIgPSAyNTUgKiAodURhdGFbaV0gLSB1TWluKSAvICh1TWF4IC0gdU1pbik7XG4gICAgICBjb25zdCBnID0gMjU1ICogKHZEYXRhW2ldIC0gdk1pbikgLyAodk1heCAtIHZNaW4pO1xuICAgICAgdmVsb2NpdHlEYXRhLnNldChbciwgZywgMCwgMjU1XSwgaSAqIDQpO1xuICAgIH1cblxuICAgIGN0eC5wb3N0TWVzc2FnZShbdmVsb2NpdHlEYXRhLmJ1ZmZlciwgdU1pbiwgdU1heCwgdk1pbiwgdk1heF0sIFt2ZWxvY2l0eURhdGEuYnVmZmVyXSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc2luZ2xlRGF0YSA9IHBheWxvYWRbMV07XG4gICAgY29uc3QgW21pbiwgbWF4XSA9IGNhbGNNaW5NYXgoc2luZ2xlRGF0YSk7XG4gICAgY29uc3QgdmVsb2NpdHlEYXRhID0gbmV3IFVpbnQ4QXJyYXkoc2luZ2xlRGF0YS5sZW5ndGggKiA0KTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpbmdsZURhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHIgPSAyNTUgKiAoc2luZ2xlRGF0YVtpXSAtIG1pbikgLyAobWF4IC0gbWluKTtcbiAgICAgIHZlbG9jaXR5RGF0YS5zZXQoW3IsIDAsIDAsIDI1NV0sIGkgKiA0KTtcbiAgICB9XG5cbiAgICBjdHgucG9zdE1lc3NhZ2UoW3ZlbG9jaXR5RGF0YS5idWZmZXIsIG1pbiwgbWF4XSwgW3ZlbG9jaXR5RGF0YS5idWZmZXJdKTtcbiAgfVxufSk7XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7O0FBY0EsQUFvREE7QUFDQSxBQUFPLFNBQVMsU0FBUyxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRTtJQUN6RCxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsRUFBRSxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7UUFDdkQsU0FBUyxTQUFTLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUMzRixTQUFTLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDOUYsU0FBUyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQUUsTUFBTSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUU7UUFDL0ksSUFBSSxDQUFDLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLFVBQVUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0tBQ3pFLENBQUMsQ0FBQztDQUNOOztBQUVELEFBQU8sU0FBUyxXQUFXLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRTtJQUN2QyxJQUFJLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pILE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxPQUFPLE1BQU0sS0FBSyxVQUFVLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxXQUFXLEVBQUUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pKLFNBQVMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLE9BQU8sVUFBVSxDQUFDLEVBQUUsRUFBRSxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0lBQ2xFLFNBQVMsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLElBQUksQ0FBQyxJQUFFLE1BQU0sSUFBSSxTQUFTLENBQUMsaUNBQWlDLENBQUMsR0FBQztRQUM5RCxPQUFPLENBQUMsSUFBRSxJQUFJO1lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLElBQUUsT0FBTyxDQUFDLEdBQUM7WUFDN0osSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBRSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBQztZQUN4QyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsTUFBTTtnQkFDOUIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDO2dCQUN4RCxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO2dCQUNqRCxLQUFLLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxTQUFTO2dCQUNqRDtvQkFDSSxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFO29CQUM1RyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFO29CQUN0RixJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUU7b0JBQ3JFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRTtvQkFDbkUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBQztvQkFDdEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLFNBQVM7YUFDOUI7WUFDRCxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDOUIsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBRTtRQUMxRCxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDO0tBQ3BGO0NBQ0o7O1NDdEdlLFVBQVUsQ0FBQyxLQUFlO0lBQ3hDLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQztJQUNuQixJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUM7O0lBRW5CLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3JDLElBQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVyQixJQUFJLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDcEIsR0FBRyxHQUFHLEdBQUcsQ0FBQztTQUNYO2FBQU0sSUFBSSxHQUFHLEtBQUssUUFBUSxFQUFFO1lBQzNCLEdBQUcsR0FBRyxHQUFHLENBQUM7OztZQUdWLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUN6QixHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDMUI7YUFBTTs7O1lBR0wsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMxQjtLQUNGO0lBQ0QsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztDQUNuQjs7QUNyQkQsSUFBTSxHQUFHLEdBQVcsSUFBVyxDQUFDO0FBRWhDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsVUFBTyxFQUFpQjtRQUFmLGlCQUFhOzs7O1lBQzlDLFVBQVUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxVQUFVLEtBQUssSUFBSSxFQUFFO2dCQUNqQixLQUFLLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuQixLQUFLLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuQixLQUFlLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBL0IsSUFBSSxRQUFBLEVBQUUsSUFBSSxRQUFBLENBQXNCO2dCQUNqQyxLQUFlLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBL0IsSUFBSSxRQUFBLEVBQUUsSUFBSSxRQUFBLENBQXNCO2dCQUNqQyxZQUFZLEdBQUcsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDdEQsS0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUMvQixDQUFDLEdBQUcsR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7b0JBQzVDLENBQUMsR0FBRyxHQUFHLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQztvQkFDbEQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztpQkFDekM7Z0JBRUQsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUN2RjtpQkFBTTtnQkFDQyxVQUFVLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixLQUFhLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBbEMsR0FBRyxRQUFBLEVBQUUsR0FBRyxRQUFBLENBQTJCO2dCQUNwQyxZQUFZLEdBQUcsSUFBSSxVQUFVLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDM0QsS0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUNwQyxDQUFDLEdBQUcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQ3BELFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7aUJBQ3pDO2dCQUVELEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2FBQ3pFOzs7O0NBQ0YsQ0FBQyxDQUFDIn0=",R=!1,v?G(S,X,R):function(t,i,e){var o;return function(n){return o=o||f(t,i,e),new Worker(o,n)}}(S,X,R));function V(t){return"number"==typeof t&&!isNaN(t)}function E(t){return t-Math.fround(t)}function Z(t,i){if(!t)return!1;if(i=i||devicePixelRatio||1,!(t instanceof OffscreenCanvas)){var e=t.clientWidth*i,o=t.clientHeight*i;if(e<=0||o<=0)return!1;if(t.width!==e||t.height!==o)return t.width=e,t.height=o,!0}return!1}function D(t,i,e){var o=t.createShader(i);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw t.deleteShader(o),new Error(t.getShaderInfoLog(o)||"");return o}function W(t,i,e,o,n){var s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),e instanceof Uint8Array?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,o,n,0,t.RGBA,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.bindTexture(t.TEXTURE_2D,null),s}function N(t,i){var e=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,e),i&&t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),e}var w,M=function(){function t(t,i,e,o){this.vertShader="",this.fragShader="",i&&(this.vertShader=i),e&&(this.fragShader=e),this.program=function(t,i,e){var o=D(t,t.VERTEX_SHADER,i),n=D(t,t.FRAGMENT_SHADER,e),s=t.createProgram();if(null!==s&&(t.attachShader(s,o),t.attachShader(s,n),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)))throw new Error(t.getProgramInfoLog(s)||"");return s}(t,function(t,i){return Object.keys(i).map((function(e){i[e]&&(t=t.replace(new RegExp(e,"g"),i[e]+" \n"))})),t}(this.vertShader,o),this.fragShader),this.gl=t,this.textureUnit=0,this.uniformSetters=this.createUniformSetters(),this.attribSetters=this.createAttributeSetters(),this.transfromStack=[]}return t.prototype.active=function(){return this.gl.useProgram(this.program),this},t.prototype.deactive=function(){return this.gl.deleteProgram(this.program),this},t.prototype.getBindPointForSamplerType=function(t,i){return i===t.SAMPLER_2D?t.TEXTURE_2D:i===t.SAMPLER_CUBE?t.TEXTURE_CUBE_MAP:void 0},t.prototype.createUniformSetter=function(t,i){var e,o,n=this.gl,s=n.getUniformLocation(t,i.name),r=i.type,g=i.size>1&&"[0]"===i.name.substr(-3);if(r===n.FLOAT&&g)return function(t){n.uniform1fv(s,t)};if(r===n.FLOAT)return function(t){n.uniform1f(s,t)};if(r===n.FLOAT_VEC2)return function(t){n.uniform2fv(s,t)};if(r===n.FLOAT_VEC3)return function(t){n.uniform3fv(s,t)};if(r===n.FLOAT_VEC4)return function(t){n.uniform4fv(s,t)};if(r===n.INT&&g)return function(t){n.uniform1iv(s,t)};if(r===n.INT)return function(t){n.uniform1i(s,t)};if(r===n.INT_VEC2)return function(t){n.uniform2iv(s,t)};if(r===n.INT_VEC3)return function(t){n.uniform3iv(s,t)};if(r===n.INT_VEC4)return function(t){n.uniform4iv(s,t)};if(r===n.BOOL)return function(t){n.uniform1iv(s,t)};if(r===n.BOOL_VEC2)return function(t){n.uniform2iv(s,t)};if(r===n.BOOL_VEC3)return function(t){n.uniform3iv(s,t)};if(r===n.BOOL_VEC4)return function(t){n.uniform4iv(s,t)};if(r===n.FLOAT_MAT2)return function(t){n.uniformMatrix2fv(s,!1,t)};if(r===n.FLOAT_MAT3)return function(t){n.uniformMatrix3fv(s,!1,t)};if(r===n.FLOAT_MAT4)return function(t){n.uniformMatrix4fv(s,!1,t)};if((r===n.SAMPLER_2D||r===n.SAMPLER_CUBE)&&g){for(var a=[],I=0;I<i.size;++I)a.push(this.textureUnit++);return function(t,i){return function(e){n.uniform1iv(s,i),e.forEach((function(e,o){n.activeTexture(n.TEXTURE0+i[o]),void 0!==t&&n.bindTexture(t,e)}))}}(this.getBindPointForSamplerType(n,r),a)}if(r===n.SAMPLER_2D||r===n.SAMPLER_CUBE)return e=this.getBindPointForSamplerType(n,r),o=this.textureUnit++,function(t){n.uniform1i(s,o),n.activeTexture(n.TEXTURE0+o),void 0!==e&&n.bindTexture(e,t)};throw new Error("unknown type: 0x"+r.toString(16))},t.prototype.createUniformSetters=function(){var t=this.gl;this.textureUnit=0;var i={};if(null!==this.program)for(var e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),o=0;o<e;++o){var n=t.getActiveUniform(this.program,o);if(!n)break;var s=n.name;"[0]"===s.substr(-3)&&(s=s.substr(0,s.length-3));var r=this.createUniformSetter(this.program,n);i[s]=r}return i},t.prototype.createAttribSetter=function(t){var i=this.gl;return function(e){i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.enableVertexAttribArray(t),void 0===e.numComponents&&void 0===e.size||i.vertexAttribPointer(t,e.numComponents||e.size,e.type||i.FLOAT,e.normalize||!1,e.stride||0,e.offset||0)}},t.prototype.createAttributeSetters=function(){var t=this.gl,i={};if(null!==this.program)for(var e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),o=0;o<e;++o){var n=t.getActiveAttrib(this.program,o);if(!n)break;var s=t.getAttribLocation(this.program,n.name);i[n.name]=this.createAttribSetter(s)}return i},t.prototype.setAttributes=function(t,i){return i=i?i.attribSetters||i:this.attribSetters,Object.keys(t).forEach((function(e){var o=i[e];o&&o(t[e])})),this},t.prototype.setUniforms=function(t,i){return i=i?i.uniformSetters||i:this.uniformSetters,Object.keys(t).forEach((function(e){var o=i[e];o&&o(t[e])})),this},t.prototype.elements=function(t){var i;return this.elementsBuffer||(this.elementsBuffer=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.elementsBuffer),t.data&&this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t.data,(null===(i=t)||void 0===i?void 0:i.usage)||this.gl.STATIC_DRAW),void 0!==t.count&&this.runTimes(t.count),t.primitive&&this.setPrimitive(t.primitive),this},t.prototype.clear=function(t){return function(t,i){var e=i[0],o=i[1],n=i[2],s=i[3];t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(e,o,n,s),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST)}(this.gl,t),this.transfromStack=[],this},t.prototype.runTimes=function(t){return this.count=t||0,this},t.prototype.setPrimitive=function(t){this.primitive=t||this.gl.TRIANGLES},t.prototype.resize=function(){return Z(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this},t.prototype.draw=function(){throw new Error("should override")},t.prototype.translate=function(){throw new Error("should override")},t.prototype.rotate=function(){throw new Error("should override")},t.prototype.scale=function(){throw new Error("should override")},t}(),H="precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform vec2 u_image_res;uniform vec2 u_range;uniform vec2 u_color_range;uniform vec2 u_display_range;uniform float u_opacity;varying vec2 v_tex_pos;float calcTexture(const vec2 uv){return texture2D(u_image,uv).r;}float bilinear(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=calcTexture(vc);float tr=calcTexture(vc+vec2(px.x,0));float bl=calcTexture(vc+vec2(0,px.y));float br=calcTexture(vc+px);return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float getValue(const vec2 uv){float min=u_range.x;float max=u_range.y;float r=bilinear(uv);return r*(max-min)+min;}const float PI=3.14159265359;/***Converts mapbox style pseudo-mercator coordinates(this is just like mercator,but the unit isn't a meter,but 0..1*spans the entire world)into texture like WGS84 coordinates(this is just like WGS84,but instead of angles,it uses*intervals of 0..1).*/vec2 mercatorToWGS84(vec2 xy){float y=radians(180.0-xy.y*360.0);y=360.0/PI*atan(exp(y))-90.0;y=y/-180.0+0.5;return vec2(xy.x,y);}void main(){vec2 globalWGS84=mercatorToWGS84(v_tex_pos);float value=getValue(globalWGS84);float value_t=(value-u_color_range.x)/(u_color_range.y-u_color_range.x);vec2 ramp_pos=vec2(fract(16.0*value_t),floor(16.0*value_t)/16.0);vec4 color=texture2D(u_color_ramp,ramp_pos);bool display=value<u_display_range.y&&value>u_display_range.x;if(display){gl_FragColor=vec4(floor(255.0*color*u_opacity)/255.0);}else{gl_FragColor=vec4(0.0,0.0,0.0,0.0);}}",Y="#define GLSLIFY 1\nattribute vec3 instancePositions;attribute vec3 instancePositions64Low;attribute vec2 a_texCoord;uniform mat4 u_matrix;uniform vec4 u_cameraEye;uniform vec4 u_cameraEye64Low;uniform float u_offset;uniform sampler2D u_image;uniform vec2 u_image_res;uniform vec2 u_range;uniform vec2 u_mapping_range;varying vec2 v_tex_pos;varying float v_value;float calcTexture(const vec2 uv){return texture2D(u_image,uv).r;}float bilinear(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=calcTexture(vc);float tr=calcTexture(vc+vec2(px.x,0));float bl=calcTexture(vc+vec2(0,px.y));float br=calcTexture(vc+px);return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float getValue(const vec2 uv){float min=u_mapping_range.x;float max=u_mapping_range.y;float r=bilinear(uv);return r*(max-min)+min;}const float PI=3.14159265359;/***Converts mapbox style pseudo-mercator coordinates(this is just like mercator,but the unit isn't a meter,but 0..1*spans the entire world)into texture like WGS84 coordinates(this is just like WGS84,but instead of angles,it uses*intervals of 0..1).*/vec2 mercatorToWGS84(vec2 xy){float y=radians(180.0-xy.y*360.0);y=360.0/PI*atan(exp(y))-90.0;y=y/-180.0+0.5;return vec2(xy.x,y);}\n#modules-transformZ\nvoid main(){v_tex_pos=a_texCoord;vec2 globalWGS84=mercatorToWGS84(v_tex_pos);float value=getValue(globalWGS84);float z=transformZ(value,instancePositions);vec4 pos=vec4(instancePositions-u_cameraEye.xyz,0.0);pos+=vec4(instancePositions64Low-u_cameraEye64Low.xyz,0.0);\n#modules-project\n}",T=function(t){function i(i,e,o,n){var s=t.call(this,i,e||Y,o||H,n||{})||this;return s.vertShader=Y,s.fragShader=H,s}return A(i,t),i.prototype.draw=function(){if(void 0!==this.checkExt){var t=this.primitive||this.gl.TRIANGLES;this.checkExt?this.gl.drawElements(t,this.count,this.gl.UNSIGNED_INT,0):this.gl.drawElements(t,this.count,this.gl.UNSIGNED_SHORT,0)}else this.checkExt=this.gl.getExtension("OES_element_index_uint");return this},i.prototype.translate=function(){return this},i.prototype.rotate=function(){return this},i.prototype.scale=function(){return this},i}(M);function J(t,i){var e=document.createElement("canvas"),o=e.getContext("2d");e.width=256,e.height=1;var n=function(t){if(Array.isArray(t)&&t.length>3){for(var i=t[0],e=t[1],o=(t[2],[]),n=3;n<t.length;n+=2){var s=t[n],r=t[n+1];o.push({key:s,value:r})}return{operator:i,interpolation:{name:e[0],base:e[1]},input:o}}return console.warn("[wind-core]: style-parser style config invalid"),{}}(i).input;if(o&&n&&Array.isArray(n)){for(var s=n.map((function(t){return parseFloat(t.key)})),r=[Math.min.apply(Math,s),Math.max.apply(Math,s)],g=[t[0]||r[0],t[1]||r[1]],a=g[0],I=g[1],c=o.createLinearGradient(0,0,256,0),l=0;l<n.length;l+=1){var B=n[l].key,u=n[l].value;c.addColorStop((B-a)/(I-a),u)}return o.fillStyle=c,o.fillRect(0,0,256,1),{data:new Uint8Array(o.getImageData(0,0,256,1).data),colorRange:r}}return{}}function K(t,i,e,o){var n=o-e,s=t-e;return 0===n?0:1===i?s/n:(Math.pow(i,s)-1)/(Math.pow(i,n)-1)}function k(t,i){if(i&&Array.isArray(i)&&(w=function(t){if(Array.isArray(t)&&t.length>3){for(var i=t[0],e=t[1],o=(t[2],[]),n=3;n<t.length;n+=2){var s=t[n],r=t[n+1];o.push({key:s,value:r})}return{operator:i,interpolation:{name:e[0],base:e[1]},input:o}}return console.warn("[wind-core]: style-parser style config invalid"),{}}(i)),w){var e=w||{},o=e.input,n=e.interpolation;if(o&&Array.isArray(o)){var s=o.map((function(t){return t.key})),r=o.map((function(t){return t.value}));if(t<=s[0])return r[0];var g=s.length;if(t>=s[g-1])return r[g-1];var a=function(t,i){for(var e,o,n=t.length-1,s=0,r=n,g=0;s<=r;)if(e=t[g=Math.floor((s+r)/2)],o=t[g+1],e<=i){if(g===n||i<o)return g;s=g+1}else{if(!(e>i))throw new Error("Input is not a number.");r=g-1}return 0}(s,t),I=s.length-1,c=function(t,i,e,o){var n=0;return"exponential"===t.name?n=K(i,t.base,e,o):"linear"===t.name?n=K(i,1,e,o):"cubic-bezier"===t.name&&console.warn("interpolationFactor"),n}(n,t,s[a],s[a>=I?I:a+1]);return function(t,i,e){return t*(1-e)+i*e}(r[a],r[a>=I?I:a+1],c)}return 1}return V(i)?i:1}var _="precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_wind;uniform sampler2D u_color_ramp;uniform vec2 u_image_res;uniform vec2 u_wind_min;uniform vec2 u_wind_max;uniform vec2 u_color_range;uniform vec2 u_display_range;uniform float u_opacity;varying vec2 v_tex_pos;vec2 windTexture(const vec2 uv){return texture2D(u_wind,uv).rg;}float bilinearU(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=windTexture(vc).r;float tr=windTexture(vc+vec2(px.x,0)).r;float bl=windTexture(vc+vec2(0,px.y)).r;float br=windTexture(vc+px).r;return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float bilinearV(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=windTexture(vc).g;float tr=windTexture(vc+vec2(px.x,0.0)).g;float bl=windTexture(vc+vec2(0.0,px.y)).g;float br=windTexture(vc+px).g;return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float getV(const vec2 uv){float min=u_wind_min.y;float max=u_wind_max.y;float r=bilinearV(uv);return r*(max-min)+min;}float getU(const vec2 uv){float min=u_wind_min.x;float max=u_wind_max.x;float r=bilinearU(uv);return r*(max-min)+min;}float windSpeed(const vec2 uv){float u=getU(uv);float v=getV(uv);return length(vec2(u,v));}const float PI=3.14159265359;/***Converts mapbox style pseudo-mercator coordinates(this is just like mercator,but the unit isn't a meter,but 0..1*spans the entire world)into texture like WGS84 coordinates(this is just like WGS84,but instead of angles,it uses*intervals of 0..1).*/vec2 mercatorToWGS84(vec2 xy){float y=radians(180.0-xy.y*360.0);y=360.0/PI*atan(exp(y))-90.0;y=y/-180.0+0.5;return vec2(xy.x,y);}void main(){vec2 globalWGS84=mercatorToWGS84(v_tex_pos);float value=windSpeed(globalWGS84);float value_t=(value-u_color_range.x)/(u_color_range.y-u_color_range.x);vec2 ramp_pos=vec2(fract(16.0*value_t),floor(16.0*value_t)/16.0);vec4 color=texture2D(u_color_ramp,ramp_pos);bool display=value<u_display_range.y&&value>u_display_range.x;if(display){gl_FragColor=vec4(floor(255.0*color*u_opacity)/255.0);}else{gl_FragColor=vec4(0.0,0.0,0.0,0.0);}}",O="#define GLSLIFY 1\nattribute vec3 instancePositions;attribute vec3 instancePositions64Low;attribute vec2 a_texCoord;uniform mat4 u_matrix;uniform vec4 u_cameraEye;uniform vec4 u_cameraEye64Low;uniform float u_offset;uniform sampler2D u_wind;uniform vec2 u_image_res;uniform vec2 u_wind_min;uniform vec2 u_wind_max;uniform vec2 u_mapping_range;varying vec2 v_tex_pos;varying float v_value;vec2 windTexture(const vec2 uv){return texture2D(u_wind,uv).rg;}float bilinearU(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=windTexture(vc).r;float tr=windTexture(vc+vec2(px.x,0)).r;float bl=windTexture(vc+vec2(0,px.y)).r;float br=windTexture(vc+px).r;return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float bilinearV(const vec2 uv){vec2 px=1.0/u_image_res;vec2 vc=(floor(uv*u_image_res))*px;vec2 f=fract(uv*u_image_res);float tl=windTexture(vc).g;float tr=windTexture(vc+vec2(px.x,0.0)).g;float bl=windTexture(vc+vec2(0.0,px.y)).g;float br=windTexture(vc+px).g;return mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float getV(const vec2 uv){float min=u_wind_min.y;float max=u_wind_max.y;float r=bilinearV(uv);return r*(max-min)+min;}float getU(const vec2 uv){float min=u_wind_min.x;float max=u_wind_max.x;float r=bilinearU(uv);return r*(max-min)+min;}float windSpeed(const vec2 uv){float u=getU(uv);float v=getV(uv);float min=u_mapping_range.x;float max=u_mapping_range.y;float val=length(vec2(u,v));return val*(max-min)+min;}const float PI=3.14159265359;/***Converts mapbox style pseudo-mercator coordinates(this is just like mercator,but the unit isn't a meter,but 0..1*spans the entire world)into texture like WGS84 coordinates(this is just like WGS84,but instead of angles,it uses*intervals of 0..1).*/vec2 mercatorToWGS84(vec2 xy){float y=radians(180.0-xy.y*360.0);y=360.0/PI*atan(exp(y))-90.0;y=y/-180.0+0.5;return vec2(xy.x,y);}\n#modules-transformZ\nvoid main(){v_tex_pos=a_texCoord;vec2 globalWGS84=mercatorToWGS84(v_tex_pos);float value=windSpeed(globalWGS84);float z=transformZ(value,instancePositions);vec4 pos=vec4(instancePositions-u_cameraEye.xyz,0.0);pos+=vec4(instancePositions64Low-u_cameraEye64Low.xyz,0.0);\n#modules-project\n}",z=function(t){function i(i,e,o,n){var s=t.call(this,i,e||O,o||_,n||{})||this;return s.vertShader=O,s.fragShader=_,s}return A(i,t),i.prototype.draw=function(){if(void 0!==this.checkExt){var t=this.primitive||this.gl.TRIANGLES;this.checkExt?this.gl.drawElements(t,this.count,this.gl.UNSIGNED_INT,0):this.gl.drawElements(t,this.count,this.gl.UNSIGNED_SHORT,0)}else this.checkExt=this.gl.getExtension("OES_element_index_uint");return this},i.prototype.translate=function(){return this},i.prototype.rotate=function(){return this},i.prototype.scale=function(){return this},i}(M),P={renderForm:"r",styleSpec:{"fill-color":["interpolate",["linear"],["get","value"],0,"#3288bd",10,"#66c2a5",20,"#abdda4",30,"#e6f598",40,"#fee08b",50,"#fdae61",60,"#f46d43",100,"#d53e4f"],opacity:1},displayRange:[1/0,1/0],mappingRange:[0,0],widthSegments:1,heightSegments:1,createPlaneBuffer:function(t,i,e){var o=t.map((function(t){return t[0]})),n=t.map((function(t){return t[1]})),s=[Math.min.apply(Math,o),Math.max.apply(Math,o),Math.min.apply(Math,n),Math.max.apply(Math,n)];return function(t,i,e,o,n,s){for(var r=i-t,g=o-e,a=r/2,I=g/2,c=Math.floor(n),l=Math.floor(s),B=c+1,u=l+1,d=r/c,h=g/l,F=[],Q=[],C=[],y=[],U=0;U<u;U++)for(var p=U*h,A=0;A<B;A++){var m=A*d/a/2*r-t,x=p/I/2*g-e;Q.push(m,x,0),C.push(E(m),E(x),0),y.push(A/c,U/l)}for(U=0;U<l;U++)for(A=0;A<c;A++){var b=A+B*U,G=A+B*(U+1),f=A+1+B*(U+1),v=A+1+B*U;F.push(b,G,v),F.push(G,f,v)}return{uvs:{data:y,size:2},elements:{data:F,count:F.length},position:{data:Q,size:3},positionLow:{data:C,size:3}}}(s[0],s[1],s[2],s[3],i,e)},injectShaderModules:{"#modules-transformZ":"\nfloat transformZ(float value, vec3 pos) {\n  return 0.0;\n}\n    ","#modules-project":"\ngl_Position = u_matrix * vec4(pos.xy + vec2(u_offset, 0.0), pos.z + z, 1.0);\n    "}},j=function(){function t(t,i){if(this.gl=t,!this.gl)throw new Error("initialize error");i||(i={}),this.options=m(m({},P),i),this.opacity=this.options.opacity||1}return t.prototype.updateOptions=function(t){var i;this.options=m(m({},this.options),t),this.buildColorRamp(),"function"==typeof this.options.getZoom&&this.setOpacity(k(this.options.getZoom(),null===(i=this.options.styleSpec)||void 0===i?void 0:i.opacity))},t.prototype.setFillColor=function(){this.buildColorRamp()},t.prototype.setOpacity=function(t){this.opacity=t},t.prototype.handleZoom=function(){var t;"function"==typeof this.options.getZoom&&this.setOpacity(k(this.options.getZoom(),null===(t=this.options.styleSpec)||void 0===t?void 0:t.opacity))},t.prototype.buildColorRamp=function(){var t,i=J([],null===(t=this.options.styleSpec)||void 0===t?void 0:t["fill-color"]),e=i.data,o=i.colorRange;o&&(this.colorRange=o),e&&(this.colorRampTexture=W(this.gl,this.gl.NEAREST,e,16,16))},t.prototype.initialize=function(t){var i;this.drawCommand||("rg"===this.options.renderForm?this.drawCommand=new z(t,void 0,void 0,this.options.injectShaderModules):"r"===this.options.renderForm?this.drawCommand=new T(t,void 0,void 0,this.options.injectShaderModules):console.warn("This type is not supported temporarily")),this.buildColorRamp(),"function"==typeof this.options.getZoom&&this.setOpacity(k(this.options.getZoom(),null===(i=this.options.styleSpec)||void 0===i?void 0:i.opacity))},t.prototype.initializeVertex=function(t){for(var i=0,e=t.length,o=[];i<e;i++){var n=t[i],s=this.getMercatorCoordinate(n);o.push([s[0],s[1]])}var r=this.options.createPlaneBuffer(o,this.options.widthSegments||1,this.options.heightSegments||1);return{indexes:r.elements.data,quadBuffer:N(this.gl,new Float32Array(r.position.data)),quad64LowBuffer:N(this.gl,new Float32Array(r.positionLow.data)),texCoordBuffer:N(this.gl,new Float32Array(r.uvs.data))}},t.prototype.getTextureData=function(t){var i=this;return new Promise((function(e,o){if("image"===t.type&&t.url)(B=t.url,new Promise((function(t,i){B||i(new Event("url is null"));var e=new Image;e.crossOrigin="anonymous",e.onload=function(){return t(e)},e.onerror=i,e.src=B,e.complete&&t(e)}))).then((function(o){var n=m({width:o.width,height:o.height,texture:W(i.gl,i.gl.LINEAR,o,o.width,o.height)},i.initializeVertex(t.extent));"rg"===i.options.renderForm?(n.uMin=t.uMin,n.uMax=t.uMax,n.vMin=t.vMin,n.vMax=t.vMax):"r"===i.options.renderForm?(n.min=t.min,n.max=t.max):console.warn("This type is not supported temporarily"),e(n)})).catch((function(t){return o(t)}));else if("jsonArray"===t.type&&t.data){var n=t.data,s=void 0;s=t.extent?t.extent:[[n[0].header.lo1,n[0].header.la1],[n[0].header.lo1,n[0].header.la2],[n[0].header.lo2,n[0].header.la1],[n[0].header.lo2,n[0].header.la2]];var r=m({width:n[0].header.nx,height:n[0].header.ny},i.initializeVertex(s));if(i.worker||(i.worker=new L,i.worker.addEventListener("message",(function(t){var o=t.data;"rg"===i.options.renderForm?(r.uMin=o[1],r.uMax=o[2],r.vMin=o[3],r.vMax=o[4],r.texture=W(i.gl,i.gl.LINEAR,new Uint8Array(o[0]),r.width,r.height)):"r"===i.options.renderForm?(r.min=o[1],r.max=o[2],r.texture=W(i.gl,i.gl.LINEAR,new Uint8Array(o[0]),r.width,r.height)):console.warn("This type is not supported temporarily"),e(r)}))),"rg"===i.options.renderForm){var g,a;n.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":g=t;break;case"1,3":case"2,3":a=t}}));var I=new Float32Array(g.data),c=new Float32Array(a.data);i.worker.postMessage(["rg",I,c])}else if("r"===i.options.renderForm){var l=new Float32Array(n[0].data);i.worker.postMessage(["r",l])}else console.warn("This type is not supported temporarily")}var B}))},t.prototype.setData=function(t,i){var e=this;this.gl&&t&&this.getTextureData(t).then((function(t){e.data=t,i&&i(!0),e.data&&e.initialize(e.gl),e.options.triggerRepaint&&(e.handleZoom(),e.options.triggerRepaint())})).catch((function(t){i&&i(!1),console.error(t)}))},t.prototype.getData=function(){return this.data},t.prototype.getMercatorCoordinate=function(t){return[t[0],t[1]]},t.prototype.prerender=function(){},t.prototype.render=function(t,i,e){var o;if(this.data&&this.drawCommand&&this.data.texture&&this.colorRampTexture){var n=this.opacity,s={u_opacity:V(n)?n:1,u_image_res:[this.data.width,this.data.height],u_matrix:t,u_offset:V(i)?i:0,u_color_ramp:this.colorRampTexture,u_color_range:this.colorRange,u_mapping_range:this.options.mappingRange||[0,0]};if(e&&(s.u_cameraEye=e.cameraEye,s.u_cameraEye64Low=e.cameraEye64Low),"rg"===this.options.renderForm){s.u_wind_min=[this.data.uMin,this.data.vMin],s.u_wind_max=[this.data.uMax,this.data.vMax],s.u_wind=this.data.texture;var r=[Math.sqrt(this.data.uMin*this.data.uMin+this.data.vMin*this.data.vMin),Math.sqrt(this.data.uMin*this.data.uMin+this.data.vMax*this.data.vMax),Math.sqrt(this.data.uMax*this.data.uMax+this.data.vMax*this.data.vMax),Math.sqrt(this.data.uMax*this.data.uMax+this.data.vMin*this.data.vMin)],g=Math.min.apply(Math,r),a=Math.max.apply(Math,r);s.u_display_range=this.options.displayRange||[g,a]}else"r"===this.options.renderForm?(s.u_range=[this.data.min,this.data.max],s.u_image=this.data.texture,s.u_display_range=this.options.displayRange||[s.u_range[0]-1,s.u_range[1]+1]):console.warn("This type is not supported temporarily");var I=this.gl.isEnabled(this.gl.BLEND);this.gl.disable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.drawCommand.active().setUniforms(s).setAttributes({instancePositions:{buffer:this.data.quadBuffer,numComponents:3},instancePositions64Low:{buffer:this.data.quad64LowBuffer,numComponents:3},a_texCoord:{buffer:this.data.texCoordBuffer,numComponents:2}}).elements({data:new Uint32Array(this.data.indexes),primitive:this.gl.TRIANGLES,count:null===(o=this.data.indexes)||void 0===o?void 0:o.length,usage:this.gl.STATIC_DRAW}).draw(),I&&this.gl.enable(this.gl.BLEND)}},t.prototype.postrender=function(){},t}();function q(t){var i=t[0],e=t[1],o=s.MercatorCoordinate.fromLngLat({lng:i,lat:e});return[o.x,o.y]}var $=function(){function t(t,i,e){this.id=t,this.type="custom",this.renderingMode="2d",this.options=e,this.data=i,this.handleZoom=this.handleZoom.bind(this)}return t.prototype.handleZoom=function(){this.scalarFill&&this.scalarFill.handleZoom()},t.prototype.initialize=function(){var t=this;!this.scalarFill&&this.gl&&(this.scalarFill=new j(this.gl,{opacity:this.options.opacity,renderForm:this.options.renderForm,styleSpec:this.options.styleSpec,displayRange:this.options.displayRange,mappingRange:this.options.mappingRange,widthSegments:this.options.widthSegments,heightSegments:this.options.heightSegments,getZoom:function(){return t.map.getZoom()},triggerRepaint:function(){t.map.triggerRepaint()},injectShaderModules:{"#modules-transformZ":"\nconst float MATH_PI = 3.141592653589793;\nconst float earthRadius = 6371008.8;\nconst float earthCircumfrence = 2.0 * MATH_PI * earthRadius;\n\n            float latFromMercatorY(float y) {\n  float y2 = 180.0 - y * 360.0;\n  return 360.0 / MATH_PI * atan(exp(y2 * MATH_PI / 180.0)) - 90.0;\n}\n\nfloat circumferenceAtLatitude(float latitude) {\n  return earthCircumfrence * cos(latitude * MATH_PI / 180.0);\n}\n\nfloat mercatorScale(float lat) {\n  return 1.0 / cos(lat * MATH_PI / 180.0);\n}\n\nfloat transformZ(float value, vec3 pos) {\n  float mercatorY = pos.y;\n  //  float scale = circumferenceAtLatitude(latFromMercatorY(mercatorY));\n  float scale = earthCircumfrence * mercatorScale(latFromMercatorY(mercatorY));\n\n  return value / scale;\n}\n          ","#modules-project":"\ngl_Position = u_matrix * vec4(pos.xy + vec2(u_offset, 0.0), pos.z + z, pos.w);\ngl_Position.w += u_cameraEye.w;\n    "}}),this.scalarFill.getMercatorCoordinate=q,this.map.on("zoom",this.handleZoom)),this.data&&this.setData(this.data)},t.prototype.onAdd=function(t,i){this.gl=i,this.map=t,this.map&&this.initialize()},t.prototype.setData=function(t){var i=this;return new Promise((function(e,o){i.data=t,i.data&&i.scalarFill?i.scalarFill.setData(i.data,(function(t){t?e(!0):o(!1)})):e(!1)}))},t.prototype.onRemove=function(t){delete this.gl,delete this.map,t.off("zoom",this.handleZoom)},t.prototype.getWrappedWorlds=function(){var t=[0];if(this.options.wrapX)for(var i=this.map.transform,e=i.width,o=i.height,n=this.map.transform.pointCoordinate(new s.Point(0,0)),r=this.map.transform.pointCoordinate(new s.Point(e,0)),g=this.map.transform.pointCoordinate(new s.Point(e,o)),a=this.map.transform.pointCoordinate(new s.Point(0,o)),I=Math.floor(Math.min(n.x,r.x,g.x,a.x)),c=Math.floor(Math.max(n.x,r.x,g.x,a.x)),l=I-1;l<=c+1;l++)0!==l&&t.push(l);return t},t.prototype.render=function(t,i){var e=function(t){var i,e,o,n,s,r,g,a,I,c,l,B,u,d,h,F,Q,C,y,U,p,A,m,x,b,G,f,v,S,X,R,L=function(t,i,e){var o=i[0],n=i[1],s=i[2],r=i[3];return t[0]=e[0]*o+e[4]*n+e[8]*s+e[12]*r,t[1]=e[1]*o+e[5]*n+e[9]*s+e[13]*r,t[2]=e[2]*o+e[6]*n+e[10]*s+e[14]*r,t[3]=e[3]*o+e[7]*n+e[11]*s+e[15]*r,t}([],[0,0,0,1],(i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=(e=t)[0],n=e[1],s=e[2],r=e[3],g=e[4],a=e[5],I=e[6],c=e[7],l=e[8],B=e[9],u=e[10],d=e[11],h=e[12],F=e[13],Q=e[14],C=e[15],(R=(y=o*a-n*g)*(X=u*C-d*Q)-(U=o*I-s*g)*(S=B*C-d*F)+(p=o*c-r*g)*(v=B*Q-u*F)+(A=n*I-s*a)*(f=l*C-d*h)-(m=n*c-r*a)*(G=l*Q-u*h)+(x=s*c-r*I)*(b=l*F-B*h))?(R=1/R,i[0]=(a*X-I*S+c*v)*R,i[1]=(s*S-n*X-r*v)*R,i[2]=(F*x-Q*m+C*A)*R,i[3]=(u*m-B*x-d*A)*R,i[4]=(I*f-g*X-c*G)*R,i[5]=(o*X-s*f+r*G)*R,i[6]=(Q*p-h*x-C*U)*R,i[7]=(l*x-u*p+d*U)*R,i[8]=(g*S-a*f+c*b)*R,i[9]=(n*f-o*S-r*b)*R,i[10]=(h*m-F*p+C*y)*R,i[11]=(B*p-l*m-d*y)*R,i[12]=(a*G-g*v-I*b)*R,i[13]=(o*v-n*G+s*b)*R,i[14]=(F*U-h*A-Q*y)*R,i[15]=(l*A-B*U+u*y)*R,i):null)),V=1/L[3];return(L=L.map((function(t){return t/L[3]})))[3]=V,L}(i),o=e.map((function(t){return E(t)}));if(this.data&&this.scalarFill)for(var n=this.getWrappedWorlds(),s=0;s<n.length;s++)this.scalarFill.render(i,n[s],{cameraEye:e,cameraEye64Low:o})},t}(),tt={doubleBuffer:!1,windOptions:F},it=function(t){function i(i,e,o){void 0===o&&(o={});var n=t.call(this,i,Object.assign({},tt,o))||this;return n.field=null,n.pickWindOptions(),e&&n.setData(e),n.stop=n.stop.bind(n),n.render=n.render.bind(n),n.handleResize=n.handleResize.bind(n),n}return function(t,i){function e(){this.constructor=t}r(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}(i,t),i.prototype.onAdd=function(i){if(t.prototype.onAdd.call(this,i),!this.map)throw new Error("map is null");null!==this.canvas&&(this.render(),this.registerEvents())},i.prototype.handleResize=function(){this.canvas&&this.resizeCanvas(this.canvas),this.render()},i.prototype.registerEvents=function(){this.map.on("resize",this.handleResize),this.map.on("movestart",this.stop),this.map.on("moveend",this.render),this.map.on("zoomstart",this.stop),this.map.on("zoomend",this.render),this.map.on("rotatestart",this.stop),this.map.on("rotateend",this.render),this.map.on("pitchstart",this.stop),this.map.on("pitchend",this.render)},i.prototype.unregisterEvents=function(){this.map.off("resize",this.handleResize),this.map.off("movestart",this.stop),this.map.off("moveend",this.render),this.map.off("zoomstart",this.stop),this.map.off("zoomend",this.render),this.map.off("rotatestart",this.stop),this.map.off("rotateend",this.render),this.map.off("pitchstart",this.stop),this.map.off("pitchend",this.render)},i.prototype.stop=function(){this.wind&&this.wind.clearCanvas()},i.prototype.render=function(){if(this.map){var t=this.getWindOptions();if(!this.wind&&this.map&&null!==this.canvas){var i=this.canvas.getContext("2d");if(!i)return void console.error("create canvas context failed");var e=this.getData();this.wind=new C(i,t,e),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){}}this.wind.prerender(),this.wind.render()}},i.prototype.remove=function(){t.prototype.remove.call(this),this.wind&&this.wind.stop(),this.unregisterEvents()},i.prototype.pickWindOptions=function(){var t=this;Object.keys(F).forEach((function(i){i in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[i]=t.options[i])}))},i.prototype.getData=function(){return this.field},i.prototype.setData=function(t){var i,e;return t&&t.checkFields&&t.checkFields()?this.field=t:(e=t,Array.isArray(e)?this.field=function(t){var i,e;if(console.time("format-data"),t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":i=t;break;case"1,3":case"2,3":e=t}})),e&&i){var o=i.header,n=new h({xmin:o.lo1,ymin:o.la1,xmax:o.lo2,ymax:o.la2,deltaX:o.dx,deltaY:o.dy,cols:o.nx,rows:o.ny,us:i.data,vs:e.data});return console.timeEnd("format-data"),n}}(t):console.error("Illegal data")),null===(i=null===this||void 0===this?void 0:this.wind)||void 0===i||i.updateData(this.field),this},i.prototype.setWindOptions=function(t){var i=this.options.windOptions||{};if(this.options=B(this.options,{windOptions:B(i,t||{})}),this.wind){var e=this.options.windOptions;this.wind.setOptions(e),this.wind.prerender()}},i.prototype.getWindOptions=function(){return this.options.windOptions||{}},i}(U);i.default=it}.call(this,e(220)(t),e(221).Buffer)}}]);