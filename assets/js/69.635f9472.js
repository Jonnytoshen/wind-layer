(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{833:function(t,i,e){"use strict";e.r(i),e.d(i,"Field",(function(){return u})),e.d(i,"WindLayer",(function(){return y}));var n=e(134),o=(e(132),e(6),e(198),e(98),e(99),e(199),e(200),e(201),e(95),e(96),e(202),e(203),e(204),e(197),e(818));
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * leaflet-wind v1.0.0-alpha.10
 * build-time: 2021-3-26 15:23
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.10
 * build-time: 2021-3-26 15:21
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function s(){for(var t=arguments,i=0,e=0,n=arguments.length;e<n;e++)i+=t[e].length;var o=Array(i),s=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,h=r.length;a<h;a++,s++)o[s]=r[a];return o}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){var e=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1;o<arguments.length;o++){var s=e[o];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},writable:!0,configurable:!0});var r=Object.prototype.hasOwnProperty,a="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function h(t){if(!function(t){var i=Object(n.a)(t);return null!==t&&("object"===i||"function"===i)}(t))return!1;var i=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(a&&a in Object(t)))return toString.call(t);var i=r.call(t,a),e=t[a],n=!1;try{t[a]=void 0,n=!0}catch(t){}var o=Object.prototype.toString.call(t);return n&&(i?t[a]=e:delete t[a]),o}(t);return"[object Function]"===i||"[object AsyncFunction]"===i||"[object GeneratorFunction]"===i||"[object Proxy]"===i}function l(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function c(t){for(var i=arguments,e=[],n=1;n<arguments.length;n++)e[n-1]=i[n];return Object.assign.apply(Object,s([t],e))}function p(t){return null!=t&&!isNaN(t)}var d=function(){function t(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),u=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaY<0&&this.ymin<this.ymax?console.warn("[wind-core]: The data is flipY"):(this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin)),this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),e=Math.ceil((this.ymax-this.ymin)/t.deltaY);i===this.cols&&e===this.rows||console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],i=0,e=this.rows,n=this.cols,o=this.us,s=this.vs,r=0;r<e;r++){for(var a=[],h=0;h<n;h++,i++){var l=o[i],c=s[i],p=this.isValid(l)&&this.isValid(c);a[h]=p?new d(l,c):null}this.isContinuous&&a.push(a[0]),t[r]=a}return t},t.prototype.release=function(){this.grid=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,i,e,n,o,s){var r=1-t,a=1-i,h=r*a,l=t*a,c=r*i,p=t*i,u=e.u*h+n.u*l+o.u*c+s.u*p,f=e.v*h+n.v*l+o.v*c+s.v*p;return new d(u,f)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,i,e=this.grid.length,n=this.grid[0].length,o=0;o<e;o++)for(var s=0;s<n;s++){var r=this.grid[o][s];if(null!==r){var a=r.m||r.magnitude();void 0===t?t=a:void 0===i?(i=a,t=Math.min(t,i),i=Math.max(t,i)):(t=Math.min(a,t),i=Math.max(a,i))}}return[t,i]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},t.prototype.contains=function(t,i){var e,n=this.getWrappedLongitudes(),o=n[0],s=n[1],r=t>=o&&t<=s;return e=this.deltaY>=0?i>=this.ymin&&i<=this.ymax:i>=this.ymax&&i<=this.ymin,r&&e},t.prototype.getDecimalIndexes=function(t,i){var e,n;return[((e=t-this.xmin)-(n=360)*Math.floor(e/n))/this.deltaX,(this.ymax-i)/this.deltaY]},t.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),n=Math.floor(e[0]),o=Math.floor(e[1]),s=this.clampColumnIndex(n),r=this.clampRowIndex(o);return this.valueAtIndexes(s,r)},t.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var e=this.getDecimalIndexes(t,i),n=e[0],o=e[1];return this.interpolatePoint(n,o)},t.prototype.hasValueAt=function(t,i){return null!==this.valueAt(t,i)},t.prototype.interpolatePoint=function(t,i){var e=this.getFourSurroundingIndexes(t,i),n=e[0],o=e[1],s=e[2],r=e[3],a=this.getFourSurroundingValues(n,o,s,r);if(a){var h=a[0],l=a[1],c=a[2],p=a[3];return this.bilinearInterpolateVector(t-n,i-s,h,l,c,p)}return null},t.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var e=this.cols-1;return t>e&&(i=e),i},t.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var e=this.rows-1;return t>e&&(i=e),i},t.prototype.getFourSurroundingIndexes=function(t,i){var e=Math.floor(t),n=e+1;this.isContinuous&&n>=this.cols&&(n=0),n=this.clampColumnIndex(n);var o=this.clampRowIndex(Math.floor(i));return[e,n,o,this.clampRowIndex(o+1)]},t.prototype.getFourSurroundingValues=function(t,i,e,n){var o;if(o=this.grid[e]){var s=o[t],r=o[i];if(this.isValid(s)&&this.isValid(r)&&(o=this.grid[n])){var a=o[t],h=o[i];if(this.isValid(a)&&this.isValid(h))return[s,r,a,h]}}return null},t.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},t.prototype.lonLatAtIndexes=function(t,i){return[this.longitudeAtX(t),this.latitudeAtY(i)]},t.prototype.longitudeAtX=function(t){var i=this.deltaX/2,e=this.xmin+i+t*this.deltaX;return this.wrappedX&&(e=e>180?e-360:e),e},t.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},t.prototype.randomize=function(t,i,e,n){void 0===t&&(t={});var o=Math.random()*(i||this.cols)|0,s=Math.random()*(e||this.rows)|0,r=n([o,s]);return null!==r?(t.x=r[0],t.y=r[1]):(t.x=this.longitudeAtX(o),t.y=this.latitudeAtY(s)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,i,e){},t}(),f={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0};function m(t,i,e,n){return Math.max(0,Math.min(n.length-1,Math.round((t-i)/(e-i)*(n.length-1))))}var v=function(){function t(t,i,e){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),e&&this.updateData(e)}return t.prototype.setOptions=function(t){this.options=Object.assign({},f,t);var i=this.ctx.canvas,e=i.width,n=i.height;"particleAge"in t&&!("maxAge"in t)&&l(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&l(this.options.particleMultiplier)&&(this.options.paths=Math.round(e*n*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,e=t.height,n=this.particles,o=this.options.maxAge,s=h(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,r=0,a=n.length;r<a;r++){var l=n[r];l.age>o&&(l.age=0,this.field.randomize(l,i,e,this.unproject));var c=l.x,p=l.y,d=this.field.interpolatedValueAt(c,p);if(null===d)l.age=o;else{var u=c+d.u*s,f=p+d.v*s;this.field.hasValueAt(u,f)?(l.xt=u,l.yt=f,l.m=d.m):(l.x=u,l.y=f,l.age=o)}l.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t,i,e=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=l(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(i=this.options.colorScale)&&("string"==typeof i||null!==i.constructor&&i.constructor===String)?this.options.colorScale:"#fff";var n=0,o=e.length;if(this.field&&o>0){var s=void 0,r=void 0;for(p(this.options.minVelocity)&&p(this.options.maxVelocity)?(s=this.options.minVelocity,r=this.options.maxVelocity):(s=(t=this.field.range)[0],r=t[1]);n<o;n++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](e[n],s,r)}},t.prototype.drawPixelParticle=function(t,i,e){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&p(o[0])&&p(o[1])&&p(n[0])&&p(n[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(n[0],n[1]),this.ctx.lineTo(o[0],o[1]),h(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var s=m(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[s]}h(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,i,e){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&p(o[0])&&p(o[1])&&p(n[0])&&p(n[1])&&this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){var s=this.project(n),r=this.project(o);if(s&&r){if(this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(r[0],r[1]),t.x=t.xt,t.y=t.yt,h(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var a=m(t.m,i,e,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}h(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,e=t.height,n="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,o=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,e,this.unproject);for(var s=0;s<n;s++)o.push(this.field.randomize({age:this.randomize()},i,e,this.unproject));return o},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,i=[],e=0;e<arguments.length;e++)i[e]=t[e];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate()))},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=u,t}(),y=o.Layer.extend({options:{},initialize:function(t,i,e){if(!t)throw Error("layer id must be specified");this._layerId=t,o.Util.setOptions(this,e),this.field=null,this._map=null,this.pickWindOptions(),this.devicePixelRatio=this.options.devicePixelRatio||window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI,i&&this.setData(i)},_createCanvas:function(t,i){var e=o.DomUtil.create("div","leaflet-canvas-layer"),n=function(t,i,e,n){if("undefined"!=typeof document){var o=document.createElement("canvas");return o.width=t*e,o.height=i*e,o}return new n(t*e,i*e)}(this._width,this._height,this.devicePixelRatio);return n.id=String(t),n.style.position="absolute",n.style.top=String(0),n.style.left=String(0),n.style.zIndex=String(i),n.style.willChange="transform",n.style.width=this._width+"px",n.style.height=this._height+"px",e.appendChild(n),this._map.getPanes().overlayPane.appendChild(e),{layer:e,canvas:n}},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);o.DomUtil.setPosition(this.canvas,t)},_onResize:function(t){this.canvas.width=t.newSize.x,this.canvas.height=t.newSize.y},_zoomStart:function(){this._moveStart()},_moveStart:function(){this._updating||(this._updating=!0)},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),e=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);o.DomUtil.setTransform(this.canvas,e,i)},_resizeCanvas:function(t){this.canvas.style.width=this._width*t+"px",this.canvas.style.height=this._height*t+"px"},_render:function(){console.log("render"),this._reset();var t=this.getWindOptions();if(!this.wind&&this._map){var i=this.canvas.getContext("2d"),e=this.getData();this.wind=new v(i,t,e),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){}}this.wind.prerender(),this.wind.render()},project:function(t){var i=this._map.latLngToContainerPoint(new o.LatLng(t[1],t[0]));return[i.x*this.devicePixelRatio,i.y*this.devicePixelRatio]},unproject:function(t){var i=this._map.containerPointToLatLng(new o.Point(t[0],t[1]));return[i.lng,i.lat]},intersectsCoordinate:function(t){return this._map.getBounds().contains(Object(o.latLng)(t[1],t[0]))},onAdd:function(t){this._map=t,this._width=t.getSize().x,this._height=t.getSize().y;var i=this._createCanvas(this._layerId,this.options.zIndex||1),e=i.layer,n=i.canvas;this.layer=e,this.canvas=n;var s=this._map.options.zoomAnimation&&o.Browser.any3d;o.DomUtil.addClass(this.canvas,"leaflet-zoom-"+(s?"animated":"hide")),this._render()},onRemove:function(){this.wind&&this.wind.stop(),this._map.getPanes().overlayPane.removeChild(this.layer),this._map.off(this.getEvents(),this),this.canvas=null},getEvents:function(){var t={resize:this._onResize,viewreset:this._render,moveend:this._render,zoomEnd:this._render};return this._map.options.zoomAnimation&&o.Browser.any3d&&(t.zoomanim=this._animateZoom),t},pickWindOptions:function(){var t=this;Object.keys(f).forEach((function(i){i in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[i]=t.options[i])}))},getData:function(){return this.field},setData:function(t){var i,e;return t&&t.checkFields&&t.checkFields()?this.field=t:(e=t,Array.isArray(e)?this.field=function(t){var i,e;if(console.time("format-data"),t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":i=t;break;case"1,3":case"2,3":e=t}})),e&&i){var n=i.header,o=new u({xmin:n.lo1,ymin:n.la1,xmax:n.lo2,ymax:n.la2,deltaX:n.dx,deltaY:n.dy,cols:n.nx,rows:n.ny,us:i.data,vs:e.data});return console.timeEnd("format-data"),o}}(t):console.error("Illegal data")),null===(i=null===this||void 0===this?void 0:this.wind)||void 0===i||i.updateData(this.field),this},setWindOptions:function(t){var i=this.options.windOptions||{};if(this.options=c(this.options,{windOptions:c(i,t||{})}),this.wind){var e=this.options.windOptions;this.wind.setOptions(e),this.wind.prerender()}},getWindOptions:function(){return this.options.windOptions||{}}});i.default=y}}]);