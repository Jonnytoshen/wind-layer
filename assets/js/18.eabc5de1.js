(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{645:function(t,e,i){"use strict";e.a={ANIMATING:0,INTERACTING:1}},661:function(t,e,i){"use strict";var n,o=i(591),r=i(614),a=i(684),s=i(651),c=i(620),h=i(596),p=i(617),u=i(680),l=i(598),d=i(624),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=function(t){function e(e){var i=t.call(this)||this;return i.boundHandleImageChange_=i.handleImageChange_.bind(i),i.layer_=e,i}return f(e,t),e.prototype.getFeatures=function(t){return Object(h.b)()},e.prototype.prepareFrame=function(t){return Object(h.b)()},e.prototype.renderFrame=function(t,e){return Object(h.b)()},e.prototype.loadedTileCallback=function(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i},e.prototype.createLoadedTileFinder=function(t,e,i){return function(n,o){var r=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,o,r)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,i,n,o){},e.prototype.getDataAtPixel=function(t,e,i){return Object(h.b)()},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){t.target.getState()===p.a.LOADED&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return e!=p.a.LOADED&&e!=p.a.ERROR&&t.addEventListener(l.a.CHANGE,this.boundHandleImageChange_),e==p.a.IDLE&&(t.load(),e=t.getState()),e==p.a.LOADED},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==d.a.READY&&t.changed()},e}(u.a),y=i(608),v=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),m=function(t){function e(e){var i=t.call(this,e)||this;return i.container=null,i.renderedResolution,i.tempTransform_=Object(y.c)(),i.pixelTransform=Object(y.c)(),i.inversePixelTransform=Object(y.c)(),i.context=null,i.containerReused=!1,i.createTransformStringCanvas_=Object(r.a)(1,1).canvas,i}return v(e,t),e.prototype.useContainer=function(t,e,i){var n,o,a=this.getLayer().getClassName();t&&""===t.style.opacity&&t.className===a&&((c=t.firstElementChild)instanceof HTMLCanvasElement&&(o=c.getContext("2d")));if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement("div")).className=a;var s=n.style;s.position="absolute",s.width="100%",s.height="100%";var c=(o=Object(r.a)()).canvas;n.appendChild(c),(s=c.style).position="absolute",s.left="0",s.transformOrigin="top left",this.container=n,this.context=o}},e.prototype.clip=function(t,e,i){var n=e.pixelRatio,r=e.size[0]*n/2,a=e.size[1]*n/2,s=e.viewState.rotation,h=Object(o.C)(i),p=Object(o.D)(i),u=Object(o.w)(i),l=Object(o.v)(i);Object(y.a)(e.coordinateToPixelTransform,h),Object(y.a)(e.coordinateToPixelTransform,p),Object(y.a)(e.coordinateToPixelTransform,u),Object(y.a)(e.coordinateToPixelTransform,l),t.save(),Object(c.s)(t,-s,r,a),t.beginPath(),t.moveTo(h[0]*n,h[1]*n),t.lineTo(p[0]*n,p[1]*n),t.lineTo(u[0]*n,u[1]*n),t.lineTo(l[0]*n,l[1]*n),t.clip(),Object(c.s)(t,s,r,a)},e.prototype.clipUnrotated=function(t,e,i){var n=Object(o.C)(i),r=Object(o.D)(i),a=Object(o.w)(i),s=Object(o.v)(i);Object(y.a)(e.coordinateToPixelTransform,n),Object(y.a)(e.coordinateToPixelTransform,r),Object(y.a)(e.coordinateToPixelTransform,a),Object(y.a)(e.coordinateToPixelTransform,s);var c=this.inversePixelTransform;Object(y.a)(c,n),Object(y.a)(c,r),Object(y.a)(c,a),Object(y.a)(c,s),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,e,i){var n=this.getLayer();if(n.hasListener(t)){var o=new a.a(t,this.inversePixelTransform,i,e);n.dispatchEvent(o)}},e.prototype.preRender=function(t,e){this.dispatchRenderEvent_(s.a.PRERENDER,t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(s.a.POSTRENDER,t,e)},e.prototype.getRenderTransform=function(t,e,i,n,o,r,a){var s=o/2,c=r/2,h=n/e,p=-h,u=-t[0]+a,l=-t[1];return Object(y.b)(this.tempTransform_,s,c,h,p,-i,u,l)},e.prototype.getDataAtPixel=function(t,e,i){var n,o=Object(y.a)(this.inversePixelTransform,t.slice()),r=this.context;try{n=r.getImageData(Math.round(o[0]),Math.round(o[1]),1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:n}return 0===n[3]?null:n},e.prototype.createTransformString=function(t){return this.createTransformStringCanvas_.style.transform=Object(y.i)(t),this.createTransformStringCanvas_.style.transform},e}(g);e.a=m},843:function(t,e,i){"use strict";i.r(e);var n,o=i(134),r=(i(207),i(208),i(132),i(6),i(198),i(98),i(99),i(199),i(200),i(201),i(95),i(96),i(202),i(203),i(204),i(135),i(13),i(197),i(591)),a=i(664),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),c=function(t){function e(e){var i=e||{};return t.call(this,i)||this}return s(e,t),e}(a.a),h=i(687),p=i(645),u=i(605),l=i(661),d=i(608),f=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),g=function(t){function e(e){var i=t.call(this,e)||this;return i.image_=null,i}return f(e,t),e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,n=t.viewState,o=n.resolution,a=this.getLayer().getSource(),s=t.viewHints,c=t.extent;if(void 0!==e.extent&&(c=Object(r.B)(c,Object(u.fromUserExtent)(e.extent,n.projection))),!s[p.a.ANIMATING]&&!s[p.a.INTERACTING]&&!Object(r.H)(c)){var l=n.projection;if(!h.a){var d=a.getProjection();d&&(l=d)}var f=a.getImage(c,o,i,l);f&&this.loadImage(f)&&(this.image_=f)}return!!this.image_},e.prototype.renderFrame=function(t,e){var i=this.image_,n=i.getExtent(),o=i.getResolution(),a=i.getPixelRatio(),s=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,h=t.viewState,p=h.center,l=h.resolution,f=t.size,g=c*o/(l*a),y=Math.round(f[0]*c),v=Math.round(f[1]*c),m=h.rotation;if(m){var x=Math.round(Math.sqrt(y*y+v*v));y=x,v=x}Object(d.b)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,m,-y/2,-v/2),Object(d.d)(this.inversePixelTransform,this.pixelTransform);var O=this.createTransformString(this.pixelTransform);this.useContainer(e,O,s.opacity);var b=this.context,_=b.canvas;_.width!=y||_.height!=v?(_.width=y,_.height=v):this.containerReused||b.clearRect(0,0,y,v);var w=!1;if(s.extent){var j=Object(u.fromUserExtent)(s.extent,h.projection);(w=!Object(r.g)(j,t.extent)&&Object(r.F)(j,t.extent))&&this.clipUnrotated(b,t,j)}var P=i.getImage(),I=Object(d.b)(this.tempTransform_,y/2,v/2,g,g,0,a*(n[0]-p[0])/o,a*(p[1]-n[3])/o);this.renderedResolution=o*c/a;var A=I[4],R=I[5],E=P.width*I[0],S=P.height*I[3];if(this.preRender(b,t),E>=.5&&S>=.5){var C=s.opacity,T=void 0;1!==C&&(T=this.context.globalAlpha,this.context.globalAlpha=C),this.context.drawImage(P,0,0,+P.width,+P.height,Math.round(A),Math.round(R),Math.round(E),Math.round(S)),1!==C&&(this.context.globalAlpha=T)}return this.postRender(b,t),w&&b.restore(),O!==_.style.transform&&(_.style.transform=O),this.container},e}(l.a),y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),v=function(t){function e(e){return t.call(this,e)||this}return y(e,t),e.prototype.createRenderer=function(){return new g(this)},e}(c),m=i(686),x=i(617),O=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),b=function(t){function e(e,i,n,o,r){var a=this,s=void 0!==r?x.a.IDLE:x.a.LOADED;return(a=t.call(this,e,i,n,s)||this).loader_=void 0!==r?r:null,a.canvas_=o,a.error_=null,a}return O(e,t),e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=x.a.ERROR):this.state=x.a.LOADED,this.changed()},e.prototype.load=function(){this.state==x.a.IDLE&&(this.state=x.a.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(m.a),_=i(596),w=i(601),j=i(632),P=i(619),I=i(598),A=i(757),R=i(758),E=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),S=function(t){function e(e,i,n,o,a,s){var c=this,p=e.getExtent(),u=i.getExtent(),l=u?Object(r.B)(n,u):n,d=Object(r.x)(l),f=Object(A.a)(e,i,d,o),g=h.b,y=new R.a(e,i,l,p,f*g),v=s(y.calculateSourceExtent(),f,a),m=v?x.a.IDLE:x.a.EMPTY,O=v?v.getPixelRatio():1;return(c=t.call(this,n,o,O,m)||this).targetProj_=i,c.maxSourceExtent_=p,c.triangulation_=y,c.targetResolution_=o,c.targetExtent_=n,c.sourceImage_=v,c.sourcePixelRatio_=O,c.canvas_=null,c.sourceListenerKey_=null,c}return E(e,t),e.prototype.disposeInternal=function(){this.state==x.a.LOADING&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==x.a.LOADED){var e=Object(r.E)(this.targetExtent_)/this.targetResolution_,i=Object(r.A)(this.targetExtent_)/this.targetResolution_;this.canvas_=Object(A.b)(e,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==x.a.IDLE){this.state=x.a.LOADING,this.changed();var t=this.sourceImage_.getState();t==x.a.LOADED||t==x.a.ERROR?this.reproject_():(this.sourceListenerKey_=Object(P.a)(this.sourceImage_,I.a.CHANGE,(function(t){var e=this.sourceImage_.getState();e!=x.a.LOADED&&e!=x.a.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){Object(P.c)(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(m.a),C=i(699),T=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),M="imageloadstart",D="imageloadend",L="imageloaderror",F=function(t){function e(e,i){var n=t.call(this,e)||this;return n.image=i,n}return T(e,t),e}(j.a);var W=function(t){function e(e){var i=t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state})||this;return i.resolutions_=void 0!==e.resolutions?e.resolutions:null,i.reprojectedImage_=null,i.reprojectedRevision_=0,i}return T(e,t),e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Object(w.e)(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,i,n){var o=this.getProjection();if(h.a&&o&&n&&!Object(u.equivalent)(o,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Object(u.equivalent)(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==e&&Object(r.p)(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new S(o,n,t,e,i,function(t,e,i){return this.getImageInternal(t,e,i,o)}.bind(this)),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return o&&(n=o),this.getImageInternal(t,e,i,n)},e.prototype.getImageInternal=function(t,e,i,n){return Object(_.b)()},e.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case x.a.LOADING:this.loading=!0,this.dispatchEvent(new F(M,e));break;case x.a.LOADED:this.loading=!1,this.dispatchEvent(new F(D,e));break;case x.a.ERROR:this.loading=!1,this.dispatchEvent(new F(L,e))}},e}(C.a),N=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),k=function(t){function e(e){var i=this,n=e||{};return(i=t.call(this,{attributions:n.attributions,projection:n.projection,resolutions:n.resolutions,state:n.state})||this).canvasFunction_=n.canvasFunction,i.canvas_=null,i.renderedRevision_=0,i.ratio_=void 0!==n.ratio?n.ratio:1.5,i}return N(e,t),e.prototype.getImageInternal=function(t,e,i,n){e=this.findNearestResolution(e);var o=this.canvas_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==i&&Object(r.g)(o.getExtent(),t))return o;t=t.slice(),Object(r.J)(t,this.ratio_);var a=[Object(r.E)(t)/e*i,Object(r.A)(t)/e*i],s=this.canvasFunction_.call(this,t,e,i,a,n);return s&&(o=new b(t,e,i,s)),this.canvas_=o,this.renderedRevision_=this.getRevision(),o},e}(W);i.d(e,"Field",(function(){return tt})),i.d(e,"PerfWindLayer",(function(){return ct})),i.d(e,"WindLayer",(function(){return ut})),i.d(e,"WindLayerRender",(function(){return at}));
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * ol5-wind v1.0.0-alpha.10
 * build-time: 2021-3-26 15:21
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var V=function(t,e){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function G(t,e){function i(){this.constructor=t}V(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}
/*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.10
 * build-time: 2021-3-26 15:23
 * LICENSE: MIT
 * (c) 2017-2021 https://github.com/sakitam-fdd/wind-layer#readme
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function X(){for(var t=arguments,e=0,i=0,n=arguments.length;i<n;i++)e+=t[i].length;var o=Array(e),r=0;for(i=0;i<n;i++)for(var a=arguments[i],s=0,c=a.length;s<c;s++,r++)o[r]=a[s];return o}Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),o=1;o<arguments.length;o++){var r=i[o];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}return n},writable:!0,configurable:!0});var Y=Object.prototype.hasOwnProperty,z="undefined"!=typeof Symbol?Symbol.toStringTag:void 0;function H(t){if(!function(t){var e=Object(o.a)(t);return null!==t&&("object"===e||"function"===e)}(t))return!1;var e=function(t){if(null===t)return void 0===t?"[object Undefined]":"[object Null]";if(!(z&&z in Object(t)))return toString.call(t);var e=Y.call(t,z),i=t[z],n=!1;try{t[z]=void 0,n=!0}catch(t){}var o=Object.prototype.toString.call(t);return n&&(e?t[z]=i:delete t[z]),o}(t);return"[object Function]"===e||"[object AsyncFunction]"===e||"[object GeneratorFunction]"===e||"[object Proxy]"===e}function q(t){return"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)}function B(t){return Array.isArray(t)}function U(t){for(var e=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=e[n];return Object.assign.apply(Object,X([t],i))}function K(t){console.warn("wind-layer: "+t)}function J(t){return null!=t&&!isNaN(t)}function Q(t){var e,i;if(t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":e=t;break;case"1,3":case"2,3":i=t}})),i&&e){var n=e.header;return new tt({xmin:n.lo1,ymin:n.la1,xmax:n.lo2,ymax:n.la2,deltaX:n.dx,deltaY:n.dy,cols:n.nx,rows:n.ny,us:e.data,vs:i.data})}}function Z(t,e,i,n){if("undefined"!=typeof document){var o=document.createElement("canvas");return o.width=t*i,o.height=e*i,o}return new n(t*i,e*i)}var $=function(){function t(t,e){this.u=t,this.v=e,this.m=this.magnitude()}return t.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},t.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v)*(180/Math.PI);return t<0&&(t+=360),t},t.prototype.directionFrom=function(){return(this.directionTo()+180)%360},t}(),tt=function(){function t(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaY<0&&this.ymin<this.ymax?console.warn("[wind-core]: The data is flipY"):(this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin)),this.isFields=!0;var e=Math.ceil((this.xmax-this.xmin)/t.deltaX),i=Math.ceil((this.ymax-this.ymin)/t.deltaY);e===this.cols&&i===this.rows||console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return t.prototype.buildGrid=function(){for(var t=[],e=0,i=this.rows,n=this.cols,o=this.us,r=this.vs,a=0;a<i;a++){for(var s=[],c=0;c<n;c++,e++){var h=o[e],p=r[e],u=this.isValid(h)&&this.isValid(p);s[c]=u?new $(h,p):null}this.isContinuous&&s.push(s[0]),t[a]=s}return t},t.prototype.release=function(){this.grid=[]},t.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},t.prototype.bilinearInterpolateVector=function(t,e,i,n,o,r){var a=1-t,s=1-e,c=a*s,h=t*s,p=a*e,u=t*e,l=i.u*c+n.u*h+o.u*p+r.u*u,d=i.v*c+n.v*h+o.v*p+r.v*u;return new $(l,d)},t.prototype.calculateRange=function(){if(this.grid&&this.grid[0]){for(var t,e,i=this.grid.length,n=this.grid[0].length,o=0;o<i;o++)for(var r=0;r<n;r++){var a=this.grid[o][r];if(null!==a){var s=a.m||a.magnitude();void 0===t?t=s:void 0===e?(e=s,t=Math.min(t,e),e=Math.max(t,e)):(t=Math.min(s,t),e=Math.max(s,e))}}return[t,e]}},t.prototype.isValid=function(t){return null!=t},t.prototype.getWrappedLongitudes=function(){var t=this.xmin,e=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,e=180):(e=this.xmax-360,t=this.xmin-360)),[t,e]},t.prototype.contains=function(t,e){var i,n=this.getWrappedLongitudes(),o=n[0],r=n[1],a=t>=o&&t<=r;return i=this.deltaY>=0?e>=this.ymin&&e<=this.ymax:e>=this.ymax&&e<=this.ymin,a&&i},t.prototype.getDecimalIndexes=function(t,e){var i,n;return[((i=t-this.xmin)-(n=360)*Math.floor(i/n))/this.deltaX,(this.ymax-e)/this.deltaY]},t.prototype.valueAt=function(t,e){if(!this.contains(t,e))return null;var i=this.getDecimalIndexes(t,e),n=Math.floor(i[0]),o=Math.floor(i[1]),r=this.clampColumnIndex(n),a=this.clampRowIndex(o);return this.valueAtIndexes(r,a)},t.prototype.interpolatedValueAt=function(t,e){if(!this.contains(t,e))return null;var i=this.getDecimalIndexes(t,e),n=i[0],o=i[1];return this.interpolatePoint(n,o)},t.prototype.hasValueAt=function(t,e){return null!==this.valueAt(t,e)},t.prototype.interpolatePoint=function(t,e){var i=this.getFourSurroundingIndexes(t,e),n=i[0],o=i[1],r=i[2],a=i[3],s=this.getFourSurroundingValues(n,o,r,a);if(s){var c=s[0],h=s[1],p=s[2],u=s[3];return this.bilinearInterpolateVector(t-n,e-r,c,h,p,u)}return null},t.prototype.clampColumnIndex=function(t){var e=t;t<0&&(e=0);var i=this.cols-1;return t>i&&(e=i),e},t.prototype.clampRowIndex=function(t){var e=t;t<0&&(e=0);var i=this.rows-1;return t>i&&(e=i),e},t.prototype.getFourSurroundingIndexes=function(t,e){var i=Math.floor(t),n=i+1;this.isContinuous&&n>=this.cols&&(n=0),n=this.clampColumnIndex(n);var o=this.clampRowIndex(Math.floor(e));return[i,n,o,this.clampRowIndex(o+1)]},t.prototype.getFourSurroundingValues=function(t,e,i,n){var o;if(o=this.grid[i]){var r=o[t],a=o[e];if(this.isValid(r)&&this.isValid(a)&&(o=this.grid[n])){var s=o[t],c=o[e];if(this.isValid(s)&&this.isValid(c))return[r,a,s,c]}}return null},t.prototype.valueAtIndexes=function(t,e){return this.grid[e][t]},t.prototype.lonLatAtIndexes=function(t,e){return[this.longitudeAtX(t),this.latitudeAtY(e)]},t.prototype.longitudeAtX=function(t){var e=this.deltaX/2,i=this.xmin+e+t*this.deltaX;return this.wrappedX&&(i=i>180?i-360:i),i},t.prototype.latitudeAtY=function(t){var e=this.deltaY/2;return this.ymax-e-t*this.deltaY},t.prototype.randomize=function(t,e,i,n){void 0===t&&(t={});var o=Math.random()*(e||this.cols)|0,r=Math.random()*(i||this.rows)|0,a=n([o,r]);return null!==a?(t.x=a[0],t.y=a[1]):(t.x=this.longitudeAtX(o),t.y=this.latitudeAtY(r)),t},t.prototype.checkFields=function(){return this.isFields},t.prototype.startBatchInterpolate=function(t,e,i){},t}(),et={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:.04,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0};function it(t,e,i,n){return Math.max(0,Math.min(n.length-1,Math.round((t-e)/(i-e)*(n.length-1))))}var nt=function(){function t(t,e,i){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(e),i&&this.updateData(i)}return t.prototype.setOptions=function(t){this.options=Object.assign({},et,t);var e=this.ctx.canvas,i=e.width,n=e.height;"particleAge"in t&&!("maxAge"in t)&&q(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&q(this.options.particleMultiplier)&&(this.options.paths=Math.round(i*n*this.options.particleMultiplier)),this.prerender()},t.prototype.getOptions=function(){return this.options},t.prototype.updateData=function(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())},t.prototype.moveParticles=function(){for(var t=this.ctx.canvas,e=t.width,i=t.height,n=this.particles,o=this.options.maxAge,r=H(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,a=0,s=n.length;a<s;a++){var c=n[a];c.age>o&&(c.age=0,this.field.randomize(c,e,i,this.unproject));var h=c.x,p=c.y,u=this.field.interpolatedValueAt(h,p);if(null===u)c.age=o;else{var l=h+u.u*r,d=p+u.v*r;this.field.hasValueAt(l,d)?(c.xt=l,c.yt=d,c.m=u.m):(c.x=l,c.y=d,c.age=o)}c.age++}},t.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},t.prototype.drawParticles=function(){var t,e,i=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=q(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=null!=(e=this.options.colorScale)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)?this.options.colorScale:"#fff";var n=0,o=i.length;if(this.field&&o>0){var r=void 0,a=void 0;for(J(this.options.minVelocity)&&J(this.options.maxVelocity)?(r=this.options.minVelocity,a=this.options.maxVelocity):(r=(t=this.field.range)[0],a=t[1]);n<o;n++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](i[n],r,a)}},t.prototype.drawPixelParticle=function(t,e,i){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&J(o[0])&&J(o[1])&&J(n[0])&&J(n[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(n[0],n[1]),this.ctx.lineTo(o[0],o[1]),H(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var r=it(t.m,e,i,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[r]}H(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},t.prototype.drawCoordsParticle=function(t,e,i){var n=[t.x,t.y],o=[t.xt,t.yt];if(o&&n&&J(o[0])&&J(o[1])&&J(n[0])&&J(n[1])&&this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){var r=this.project(n),a=this.project(o);if(r&&a){if(this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]),this.ctx.lineTo(a[0],a[1]),t.x=t.xt,t.y=t.yt,H(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var s=it(t.m,e,i,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[s]}H(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},t.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,e=t.width,i=t.height,n="function"==typeof this.options.paths?this.options.paths(this):this.options.paths,o=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(e,i,this.unproject);for(var r=0;r<n;r++)o.push(this.field.randomize({age:this.randomize()},e,i,this.unproject));return o},t.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},t.prototype.project=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];throw new Error("project must be overriden")},t.prototype.unproject=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];throw new Error("unproject must be overriden")},t.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},t.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},t.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},t.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},t.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),e=t-this._then;e>this.options.frameRate&&(this._then=t-e%this.options.frameRate,this.render())},t.prototype.prerender=function(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,this.starting||this.forceStop||(this.starting=!0,this._then=Date.now(),this.animate()))},t.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},t.prototype.postrender=function(){},t.Field=tt,t}(),ot=0,rt=1;var at=function(t){function e(e){return t.call(this,e)||this}return G(e,t),e.create=function(t,i){return new e(i)},e.handles=function(t){return"WIND"===t.getType()},e.prototype.prepareFrame=function(t,e){var i=this.getLayer(),n=t.viewHints,o=t.extent;return void 0!==e.extent&&(o=Object(r.B)(o,e.extent)),!this.wind||(!!i.get("forceRender")||!n[ot]&&!n[rt]&&(!(n[ot]||n[rt]||Object(r.H)(o))||!!this.wind))},e.prototype.composeFrame=function(t,e,i){var n=this;this.preCompose(i,t);var o=this.getLayer(),a=t.pixelRatio,s=t.size,c=Math.round(s[0]*a),h=Math.round(s[1]*a),p=e.extent,u=void 0!==p&&!Object(r.g)(p,t.extent)&&Object(r.F)(p,t.extent);u&&void 0!==p&&this.clip(i,t,p);var l=i.globalAlpha;i.globalAlpha=e.opacity,this.innterCanvas&&this.innterCtx?this.innterCanvas.width==c&&this.innterCanvas.height==h||(this.innterCanvas.width=c,this.innterCanvas.height=h):(this.innterCanvas=Z(s[0],s[1],a),this.innterCtx=this.innterCanvas.getContext("2d"));var d=o.getWindOptions();if(!this.wind&&this.innterCtx){var f=o.getData();this.wind=new nt(this.innterCtx,d,f),this.wind.project=this.getPixelFromCoordinateInternal.bind(this,t),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this,t),this.wind.postrender=function(){i.drawImage(n.innterCanvas,0,0,+n.innterCanvas.width,+n.innterCanvas.height),n.changed()},this.wind.prerender()}if(this.wind){if("generateParticleOption"in d)("function"==typeof d.generateParticleOption?d.generateParticleOption():d.generateParticleOption)&&this.wind.prerender();this.wind.render()}i.globalAlpha=l,u&&i.restore(),this.postCompose(i,t,e)},e.prototype.getPixelFromCoordinateInternal=function(t,e){var i=t.viewState,n=t.pixelRatio,o=Object(u.transform)(e,"EPSG:4326",i.projection);if(t){var r=function(t,e){var i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}(t.coordinateToPixelTransform,o.slice(0,2));return[r[0]*n,r[1]*n]}return null},e.prototype.intersectsCoordinate=function(t,e){var i=t.viewState,n=Object(u.transform)(e,"EPSG:4326",i.projection);return Object(r.f)(t.extent,n.slice(0,2))},e}(g),st={windOptions:{}},ct=function(t){function e(e,i){var n=this,o=U({},st,i);return(n=t.call(this,o)||this).field=null,n.options=o,n.type="WIND",n.pickWindOptions(),n._map=o.map||null,e&&n.setData(e),n}return G(e,t),e.prototype.pickWindOptions=function(){var t=this;Object.keys(et).forEach((function(e){e in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[e]=t.options[e])}))},e.prototype.getData=function(){return this.field},e.prototype.setData=function(t){return t&&t.checkFields&&t.checkFields()?this.field=t:B(t)?this.field=Q(t):console.error("Illegal data"),this},e.prototype.updateParams=function(t){return void 0===t&&(t={}),K("will move to setWindOptions"),this.setWindOptions(t),this},e.prototype.getParams=function(){return K("will move to getWindOptions"),this.getWindOptions()},e.prototype.setWindOptions=function(t){var e=this.options.windOptions||{};this.options=U(this.options,{windOptions:U(e,t||{})})},e.prototype.getWindOptions=function(){return this.options.windOptions||{}},e.prototype.getSourceState=function(){return this.field?"ready":void 0},e.prototype.getType=function(){return this.type},e.prototype.setMap=function(e){t.prototype.setMap.call(this,e)},e}(v),ht={windOptions:{}},pt=function(t){function e(e,i){void 0===i&&(i={});var n=this,o=U({},ht,i);(n=t.call(this,i)||this).options=o,n.wind=null,n.type="IMAGE",n.start=n.start.bind(n),n.stop=n.stop.bind(n),n.pickWindOptions();var r={logo:i.logo,state:i.state,attributions:i.attributions,resolutions:i.resolutions,canvasFunction:n.canvasFunction.bind(n),ratio:i.hasOwnProperty("ratio")?i.ratio:1};return n.setSource(new k(r)),e&&n.setData(e),n}return G(e,t),e.prototype.appendTo=function(t){if(!t)throw new Error("not map object");this.setMap(t)},e.prototype.start=function(){this.wind&&this.wind.start()},e.prototype.stop=function(){this.wind&&this.wind.stop()},e.prototype.canvasFunction=function(t,e,i,n,o){return this.pixelRatio=i,this.canvas?(this.canvas.width=n[0],this.canvas.height=n[1]):this.canvas=Z(n[0],n[1],i,null),this.canvas&&this.render(this.canvas),this.canvas},e.prototype.getContext=function(){if(null!==this.canvas)return this.canvas.getContext("2d")},e.prototype.render=function(t){var e=this,i=this.getMap();if(!this.getData()||!i)return this;var n=this.getWindOptions();if(t&&!this.wind){var o=this.getData(),r=this.getContext();r&&(this.wind=new nt(r,n,o),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=function(){e.changed()})}return this.wind&&(this.wind.prerender(),this.wind.render()),this},e.prototype.project=function(t){var e=this.getMap().getPixelFromCoordinate(Object(u.transform)(t,"EPSG:4326",this.viewProjection));return[e[0]*this.pixelRatio,e[1]*this.pixelRatio]},e.prototype.unproject=function(t){var e=this.getMap().getCoordinateFromPixel(t);return Object(u.transform)(e,this.viewProjection,"EPSG:4326")},e.prototype.intersectsCoordinate=function(t){var e=this.getMap();if(!e)return!1;var i=e.getView(),n=e.getSize();if(i&&n){var o=i.calculateExtent([n[0]*this.pixelRatio,n[1]*this.pixelRatio]);return Object(r.f)(o,Object(u.transform)(t,"EPSG:4326",this.viewProjection))}return!1},e.prototype.pickWindOptions=function(){var t=this;Object.keys(et).forEach((function(e){e in t.options&&(void 0===t.options.windOptions&&(t.options.windOptions={}),t.options.windOptions[e]=t.options[e])}))},e.prototype.getData=function(){return this.field},e.prototype.setData=function(t){var e;return t&&t.checkFields&&t.checkFields()?this.field=t:B(t)?this.field=Q(t):console.error("Illegal data"),this.getMap()&&this.canvas&&this.field&&(null===(e=null===this||void 0===this?void 0:this.wind)||void 0===e||e.updateData(this.field),this.render(this.canvas)),this},e.prototype.updateParams=function(t){return void 0===t&&(t={}),K("will move to setWindOptions"),this.setWindOptions(t),this},e.prototype.getParams=function(){return K("will move to getWindOptions"),this.getWindOptions()},e.prototype.setWindOptions=function(t){var e=this.options.windOptions||{};this.options=U(this.options,{windOptions:U(e,t||{})}),this.wind&&(this.wind.setOptions(this.options.windOptions),this.wind.prerender())},e.prototype.getWindOptions=function(){return this.options.windOptions||{}},e.prototype.getProjection=function(){var t=this.getMap();return t?t.getView()&&t.getView().getProjection():"EPSG:3857"},e.prototype.setMap=function(e){return!e&&this.wind&&this.wind.stop(),this.set("originMap",e),this.viewProjection=this.getProjection(),t.prototype.setMap.call(this,e)},e.prototype.getMap=function(){return this.get("originMap")},e.prototype.getType=function(){return this.type},e}(v),ut=pt;e.default=pt}}]);